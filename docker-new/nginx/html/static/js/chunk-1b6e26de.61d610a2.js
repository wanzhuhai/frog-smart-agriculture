(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b6e26de","chunk-2d22507f","chunk-2d0bae5e"],{"1a85":function(t,e,a){"use strict";a("af64")},"340d":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"h100"},[t.draggable?t._e():a("el-button",{staticClass:"margin-top-10 position-absolute right-120",attrs:{type:"primary",size:"mini",loading:t.loading,disabled:!t.checkPermi(["agriculture:layout:add"])},on:{click:function(e){t.draggable=!0}}},[t._v("更改节点排版")]),t.draggable?a("el-button-group",{staticClass:"margin-top-10 position-absolute right-120"},[a("el-button",{attrs:{type:"warning",size:"mini",disabled:!t.resetBtn},on:{click:t.handleReset}},[t._v("复位")]),a("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(e){t.draggable=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleSave}},[t._v("保存")])],1):t._e(),t.isMonitor?t._e():a("el-button",{staticClass:"margin-top-10 position-absolute right-30",attrs:{type:"warning",size:"mini",loading:t.loading,disabled:!t.checkPermi(["device:view:monitor"])},on:{click:t.beginMonitor}},[t._v("实时数据")]),t.isMonitor?a("el-button",{staticClass:"margin-top-10 position-absolute right-30 ",attrs:{type:"danger",size:"mini",loading:t.loading},on:{click:t.stopMonitor}},[t._v("关闭实时")]):t._e(),t.layout.img?a("vue-draggable-resizable",{attrs:{resizable:t.draggable,draggable:t.draggable,"class-name":"original",x:Number(t.layout.img.x),y:Number(t.layout.img.y),w:Number(t.layout.img.w),h:Number(t.layout.img.h)},on:{dragstop:function(e){return t.handleDragstop(arguments,"img")},resizestop:function(e){return t.handleResizestop(arguments,"img")}}},[a("el-image",{staticClass:"w100 h100",attrs:{src:t.device.imgUrl?t.$baseUrl+t.device.imgUrl.split(",")[0]:"",fit:"fill",lazy:!0}})],1):t._e(),t._l(t.layout.monitorList,(function(e){return a("vue-draggable-resizable",{key:e.identifier,staticClass:"border-radius-20",attrs:{"class-name":"original","class-name-draggable":"draggable","class-name-dragging":"dragging",h:"auto",w:"auto",x:Number(e.x),y:Number(e.y),resizable:!1,draggable:t.draggable,parent:!0},on:{dragstop:function(a){return t.handleDragstop(arguments,e.identifier)}}},[a("div",{staticClass:"inline-flex border-d8d8d8 border-radius-20 aic",on:{dblclick:function(a){return t.handleChartClick(e.identifier)}}},[a("div",{staticClass:"width-35 height-35 border-radius-20 flex aic jcc",style:{backgroundColor:e.color}},[a("svg-icon",{staticClass:"font-size-20 font-color-fff",attrs:{"icon-class":e.icon}})],1),a("span",{staticClass:"padding-lr-10 font-color-l1 font-size-14"},[t._v(t._s(e.name))]),a("span",{staticClass:"padding-right-10 font-color-l1 font-size-14"},[a("span",{staticClass:"font-weight-bold font-size-17"},[t._v(t._s(e.value))]),a("span",{staticClass:"margin-left-5"},[t._v(t._s(e.unit))])])])])})),t._l(t.layout.controlList,(function(e){return a("vue-draggable-resizable",{key:e.identifier,staticClass:"border-radius-10",attrs:{"class-name":"original","class-name-draggable":"draggable","class-name-dragging":"dragging",h:"auto",w:"auto",x:Number(e.x),y:Number(e.y),resizable:!1,draggable:t.draggable,parent:!0},on:{dragstop:function(a){return t.handleDragstop(arguments,e.identifier)}}},[a("div",{staticClass:"flex aic width-250 height-100 border-radius-10",staticStyle:{"background-color":"#fbfafa"}},[a("div",{staticClass:"margin-lr-15 width-50 height-50 border-radius-30 flex aic jcc",style:{backgroundColor:e.color}},[a("svg-icon",{staticClass:"font-size-20 font-color-fff",attrs:{"icon-class":"control"}})],1),a("div",{staticClass:"flex fdc height-60 jcsa"},[a("span",{staticClass:"font-size-14"},[t._v(t._s(e.name))]),a("div",{staticClass:"width-150"},["bool"==e.dataType.type?a("div",[a("el-switch",{staticStyle:{"min-width":"100px"},attrs:{size:"mini","active-text":"","inactive-text":"","active-value":"1","inactive-value":"0",disabled:t.shadowUnEnable||1==e.isReadonly},on:{change:function(a){return t.mqttPublish(e)}},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"item.shadow"}})],1):t._e(),"enum"==e.dataType.type?a("div",[a("el-select",{attrs:{size:"mini",placeholder:"请选择",disabled:t.shadowUnEnable||1==e.isReadonly},on:{change:function(a){return t.mqttPublish(e)}},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"item.shadow"}},t._l(e.dataType.enumList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),1)],1):t._e(),"string"==e.dataType.type?a("div",[a("el-input",{attrs:{placeholder:"请输入字符串 "+(e.dataType.unit?"，单位："+e.dataType.unit:""),disabled:t.shadowUnEnable||1==e.isReadonly},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"item.shadow"}},[t.shadowUnEnable||0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(a){return t.mqttPublish(e)}},slot:"append"})],1)],1):t._e(),"decimal"==e.dataType.type?a("div",[a("el-input",{attrs:{type:"number",placeholder:"请输入小数 "+(e.dataType.unit?"，单位："+e.dataType.unit:""),disabled:t.shadowUnEnable||1==e.isReadonly},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"item.shadow"}},[t.shadowUnEnable||0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(a){return t.mqttPublish(e)}},slot:"append"})],1)],1):t._e(),"integer"==e.dataType.type?a("div",[a("el-input",{attrs:{type:"integer",placeholder:"请输入整数 "+(e.dataType.unit?"，单位："+e.dataType.unit:""),disabled:t.shadowUnEnable||1==e.isReadonly},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"item.shadow"}},[t.shadowUnEnable||0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(a){return t.mqttPublish(e)}},slot:"append"})],1)],1):t._e(),"object"==e.dataType.type?a("div",[a("el-descriptions",{attrs:{column:1,size:"mini",border:""}},t._l(e.dataType.params,(function(e,i){return a("el-descriptions-item",{key:i,attrs:{label:e.name}},["bool"==e.dataType.type?a("div",[a("el-switch",{staticStyle:{"min-width":"100px"},attrs:{"active-text":"","inactive-text":"","active-value":"1","inactive-value":"0",disabled:t.shadowUnEnable||1==e.isReadonly},on:{change:function(a){return t.mqttPublish(e)}},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"param.shadow"}})],1):t._e(),"enum"==e.dataType.type?a("div",[a("el-select",{attrs:{placeholder:"请选择",disabled:t.shadowUnEnable||1==e.isReadonly},on:{change:function(a){return t.mqttPublish(e)}},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"param.shadow"}},t._l(e.dataType.enumList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),1)],1):t._e(),"string"==e.dataType.type?a("div",[a("el-input",{attrs:{placeholder:"请输入字符串",disabled:t.shadowUnEnable||1==e.isReadonly},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"param.shadow"}},[t.shadowUnEnable||0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(a){return t.mqttPublish(e)}},slot:"append"})],1)],1):t._e(),"decimal"==e.dataType.type?a("div",[a("el-input",{attrs:{type:"number",placeholder:"请输入小数 ",disabled:t.shadowUnEnable||1==e.isReadonly},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"param.shadow"}},[t.shadowUnEnable||0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(a){return t.mqttPublish(e)}},slot:"append"})],1)],1):t._e(),"integer"==e.dataType.type?a("div",[a("el-input",{attrs:{type:"integer",placeholder:"请输入整数 ",disabled:t.shadowUnEnable||1==e.isReadonly},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"param.shadow"}},[t.shadowUnEnable||0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(a){return t.mqttPublish(e)}},slot:"append"})],1)],1):t._e()])})),1)],1):t._e(),"array"==e.dataType.type?a("div",["object"!=e.dataType.arrayType?a("el-descriptions",{attrs:{column:1,size:"mini",border:""}},t._l(e.dataType.arrayModel,(function(i,n){return a("el-descriptions-item",{key:n,attrs:{label:e.name+(n+1)}},["string"==e.dataType.arrayType?a("div",[a("el-input",{attrs:{placeholder:"请输入字符串",size:"mini",disabled:t.shadowUnEnable||1==e.isReadonly},on:{input:function(a){return t.arrayItemChange(a,e)}},model:{value:i.shadow,callback:function(e){t.$set(i,"shadow",e)},expression:"model.shadow"}},[t.shadowUnEnable&&0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(e){return t.mqttPublish(i)}},slot:"append"})],1)],1):t._e(),"decimal"==e.dataType.arrayType?a("div",[a("el-input",{attrs:{type:"number",placeholder:"请输入小数 ",size:"mini",disabled:t.shadowUnEnable||1==e.isReadonly},on:{input:function(a){return t.arrayItemChange(a,e)}},model:{value:i.shadow,callback:function(e){t.$set(i,"shadow",e)},expression:"model.shadow"}},[t.shadowUnEnable&&0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(e){return t.mqttPublish(i)}},slot:"append"})],1)],1):t._e(),"integer"==e.dataType.arrayType?a("div",[a("el-input",{attrs:{type:"integer",placeholder:"请输入整数 ",size:"mini",disabled:t.shadowUnEnable||1==e.isReadonly},on:{input:function(a){return t.arrayItemChange(a,e)}},model:{value:i.shadow,callback:function(e){t.$set(i,"shadow",e)},expression:"model.shadow"}},[t.shadowUnEnable&&0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(e){return t.mqttPublish(i)}},slot:"append"})],1)],1):t._e()])})),1):t._e(),"object"==e.dataType.arrayType?a("el-collapse",t._l(e.dataType.arrayParams,(function(i,n){return a("el-collapse-item",{key:n},[a("template",{slot:"title"},[a("span",{staticStyle:{color:"#666"}},[a("i",{staticClass:"el-icon-tickets"}),t._v(" "+t._s(e.name+(n+1)))])]),a("el-descriptions",{attrs:{column:1,size:"mini",border:""}},t._l(i,(function(e,i){return a("el-descriptions-item",{key:i,attrs:{label:e.name}},["bool"==e.dataType.type?a("div",[a("el-switch",{staticStyle:{"min-width":"100px"},attrs:{"active-text":"","inactive-text":"","active-value":"1","inactive-value":"0",disabled:t.shadowUnEnable||1==e.isReadonly},on:{change:function(a){return t.mqttPublish(e)}},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"param.shadow"}})],1):t._e(),"enum"==e.dataType.type?a("div",[a("el-select",{attrs:{placeholder:"请选择",disabled:t.shadowUnEnable||1==e.isReadonly},on:{change:function(a){return t.mqttPublish(e)}},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"param.shadow"}},t._l(e.dataType.enumList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),1)],1):t._e(),"string"==e.dataType.type?a("div",[a("el-input",{attrs:{placeholder:"请输入字符串",disabled:t.shadowUnEnable||1==e.isReadonly},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"param.shadow"}},[t.shadowUnEnable||0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(a){return t.mqttPublish(e)}},slot:"append"})],1)],1):t._e(),"decimal"==e.dataType.type?a("div",[a("el-input",{attrs:{type:"number",placeholder:"请输入小数 ",disabled:t.shadowUnEnable||1==e.isReadonly},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"param.shadow"}},[t.shadowUnEnable||0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(a){return t.mqttPublish(e)}},slot:"append"})],1)],1):t._e(),"integer"==e.dataType.type?a("div",[a("el-input",{attrs:{type:"integer",placeholder:"请输入整数 ",disabled:t.shadowUnEnable||1==e.isReadonly},model:{value:e.shadow,callback:function(a){t.$set(e,"shadow",a)},expression:"param.shadow"}},[t.shadowUnEnable||0!=e.isReadonly?t._e():a("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(a){return t.mqttPublish(e)}},slot:"append"})],1)],1):t._e()])})),1)],2)})),1):t._e()],1):t._e()])])])])})),t.dialogVisible?a("el-dialog",{attrs:{title:"历史记录",visible:t.dialogVisible,width:"50%","close-on-click-modal":!1,modal:!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"flex jcsb"},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"—","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",size:"mini"},model:{value:t.daterangeTime,callback:function(e){t.daterangeTime=e},expression:"daterangeTime"}})],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.chartLoading,expression:"chartLoading"}],ref:"chart",staticClass:"w100 height-300"})]):t._e()],2)},n=[],o=a("2909"),s=a("c14f"),r=a("1da1"),l=(a("99af"),a("7db0"),a("d81d"),a("b0c0"),a("b64b"),a("d3b7"),a("25f0"),a("0643"),a("fffc"),a("4e3e"),a("a573"),a("159b"),a("e350")),d=a("a035"),c=a("b775");function u(t){return Object(c["a"])({url:"/agriculture/layout/list",method:"get",params:t})}function p(t){return Object(c["a"])({url:"/agriculture/layout",method:"post",data:t})}function h(t){return Object(c["a"])({url:"/agriculture/layout/"+t,method:"delete"})}var m=a("38be"),b={name:"",mixins:[],components:{},props:{device:{type:Object}},data:function(){return{loading:!1,draggable:!1,layoutList:[],layout:{monitorList:[],controlList:[],img:null},formLayoutList:[],imgLayout:{x:300,y:10,w:300,h:400},daterangeTime:null,queryParams:{serialNumber:null,identity:"",total:200},chartLoading:!1,dialogVisible:!1,isMonitor:!1,resetBtn:!0,shadowUnEnable:!1}},computed:{},watch:{device:{handler:function(){var t=Object(r["a"])(Object(s["a"])().m((function t(e,a){return Object(s["a"])().w((function(t){while(1)switch(t.n){case 0:if(!e.productId||!e.serialNumber){t.n=2;break}return t.n=1,this.getLayoutList();case 1:this.formatLayout(),this.connectMqtt();case 2:return t.a(2)}}),t,this)})));function e(e,a){return t.apply(this,arguments)}return e}(),immediate:!0},daterangeTime:{handler:function(){this.initChart()},deep:!0}},created:function(){},mounted:function(){},destroyed:function(){},methods:{checkPermi:l["a"],getLayoutList:function(){var t=this;return Object(r["a"])(Object(s["a"])().m((function e(){var a,i,n;return Object(s["a"])().w((function(e){while(1)switch(e.n){case 0:if(a=t.device.productId,!a){e.n=2;break}return e.n=1,u({productId:a});case 1:i=e.v,n=i.rows,t.layoutList=n,n.length>0&&(t.resetBtn=!0);case 2:return e.a(2)}}),e)})))()},formatLayout:function(){var t=this,e=this.device.productId;this.device.monitorList&&this.device.monitorList.length>0&&(this.layout.monitorList=this.device.monitorList.map((function(a,i){return{productId:e,identifier:a.id,icon:a.id,name:a.name,value:a.value?a.value:"-",unit:a.dataType.unit,color:t.$colorList[i],x:t.layoutList.find((function(t){return t.identifier==a.id}))?t.layoutList.find((function(t){return t.identifier==a.id})).x:0,y:t.layoutList.find((function(t){return t.identifier==a.id}))?t.layoutList.find((function(t){return t.identifier==a.id})).y:50*i+10,w:"auto",h:"auto"}}))),this.device.thingsModels&&this.device.thingsModels.length>0&&(this.layout.controlList=this.device.thingsModels.map((function(a,i){return{productId:e,identifier:a.id,icon:a.id,name:a.name,value:a.value?a.value:"-",unit:a.dataType.unit,color:t.$colorList[i],x:t.layoutList.find((function(t){return t.identifier==a.id}))?t.layoutList.find((function(t){return t.identifier==a.id})).x:600,y:t.layoutList.find((function(t){return t.identifier==a.id}))?t.layoutList.find((function(t){return t.identifier==a.id})).y:120*i+10,w:"auto",h:"auto",dataType:a.dataType,id:a.id,shadow:a.shadow,type:a.type}}))),this.layout.img={productId:e,identifier:"img",x:this.layoutList.find((function(t){return"img"==t.identifier}))?this.layoutList.find((function(t){return"img"==t.identifier})).x:300,y:this.layoutList.find((function(t){return"img"==t.identifier}))?this.layoutList.find((function(t){return"img"==t.identifier})).y:200,w:this.layoutList.find((function(t){return"img"==t.identifier}))?this.layoutList.find((function(t){return"img"==t.identifier})).w:200,h:this.layoutList.find((function(t){return"img"==t.identifier}))?this.layoutList.find((function(t){return"img"==t.identifier})).h:300}},handleDragstop:function(t,e){this.setValue(t,e)},handleResizestop:function(t,e){console.log(t),this.setValue(t,e)},setValue:function(t,e){console.log(e);for(var a=0;a<this.layout.monitorList.length;a++)this.layout.monitorList[a].identifier==e&&(this.layout.monitorList[a].x=t[0],this.layout.monitorList[a].y=t[1],4==t.length&&(this.layout.monitorList[a].w=t[2],this.layout.monitorList[a].h=t[3]));for(var i=0;i<this.layout.controlList.length;i++)this.layout.controlList[i].identifier==e&&(this.layout.controlList[i].x=t[0],this.layout.controlList[i].y=t[1],4==t.length&&(this.layout.controlList[i].w=t[2],this.layout.controlList[i].h=t[3]));"img"==e&&(this.layout.img.x=t[0],this.layout.img.y=t[1],4==t.length&&(this.layout.img.w=t[2],this.layout.img.h=t[3]))},handleSave:function(){var t=this;return Object(r["a"])(Object(s["a"])().m((function e(){var a,i,n,r,l;return Object(s["a"])().w((function(e){while(1)switch(e.n){case 0:if(a=t.layout,i=a.monitorList,n=a.controlList,r=a.img,l=[].concat(Object(o["a"])(i),Object(o["a"])(n),[r]),console.log(l),!(l.length>0)){e.n=2;break}return t.loading=!0,e.n=1,p(l);case 1:t.$modal.msgSuccess("保存成功"),t.loading=!1,t.draggable=!1;case 2:return e.a(2)}}),e)})))()},handleReset:function(){var t=this;return Object(r["a"])(Object(s["a"])().m((function e(){var a;return Object(s["a"])().w((function(e){while(1)switch(e.n){case 0:if(t.loading=!0,a=t.device.productId,!a){e.n=4;break}return e.n=1,h(a);case 1:return e.n=2,t.getLayoutList();case 2:return e.n=3,t.formatLayout();case 3:t.$modal.msgSuccess("重置成功"),t.loading=!1,t.draggable=!1;case 4:return e.a(2)}}),e)})))()},connectMqtt:function(){var t=this;return Object(r["a"])(Object(s["a"])().m((function e(){return Object(s["a"])().w((function(e){while(1)switch(e.n){case 0:if(null!=t.$mqttTool.client){e.n=1;break}return e.n=1,t.$mqttTool.connect();case 1:t.mqttSubscribe(),t.mqttCallback();case 2:return e.a(2)}}),e)})))()},mqttCallback:function(){var t=this;this.$mqttTool.client.on("message",(function(e,a,i){var n=JSON.parse(a.toString()),o=t.layout.monitorList;if(o.length>0)for(var s=0;s<o.length;s++)for(var r=0;r<n.length;r++)o[s].identifier==n[r].id&&(o[s].value=n[r].value)}))},mqttSubscribe:function(){var t=this.device,e="/"+t.productId+"/"+t.serialNumber+"/status/post",a="/"+t.productId+"/"+t.serialNumber+"/property/post",i="/"+t.productId+"/"+t.serialNumber+"/function/post",n="/"+t.productId+"/"+t.serialNumber+"/monitor/post",o=[];o.push(e),o.push(a),o.push(i),o.push(n),this.$mqttTool.subscribe(o)},mqttPublish:function(t){var e=this,a="",i="",n=this.device;switch(t.type){case 1:3==n.status?a="/"+n.productId+"/"+n.serialNumber+"/property-online/get":n.isShadow&&(a="/"+n.productId+"/"+n.serialNumber+"/property-offline/post"),i='{"id":"'.concat(t.id,'","value":"').concat(t.shadow,'"}');break;case 2:3==n.status?a="/"+n.productId+"/"+n.serialNumber+"/function-online/get":n.isShadow&&(a="/"+n.productId+"/"+n.serialNumber+"/function-offline/post"),i='[{"id":"'.concat(t.id,'","value":"').concat(t.shadow,'","remark":"设备控制"}]');break;case 3:a="/"+n.productId+"/"+n.serialNumber+"/ota/get",i='{"version":'+this.firmware.version+',"downloadUrl":"'+this.getDownloadUrl(this.firmware.filePath)+'"}';break;case 4:a="/"+n.productId+"/"+n.serialNumber+"/monitor/get",i=t.message;break;default:break}""!=a&&this.$mqttTool.publish(a,i,t.name).then((function(t){e.$modal.notifySuccess(t)})).catch((function(t){e.$modal.notifyError(t)}))},handleChartClick:function(t){this.dialogVisible=!0,this.queryParams.identity=t,this.initChart()},initChart:function(){var t=this;return Object(r["a"])(Object(s["a"])().m((function e(){var a,i,n,o;return Object(s["a"])().w((function(e){while(1)switch(e.n){case 0:if(t.queryParams.serialNumber=t.device.serialNumber,t.daterangeTime&&(t.queryParams.beginTime=t.daterangeTime[0],t.queryParams.endTime=t.daterangeTime[1]+" 23:59"),!String(t.queryParams.identity)){e.n=2;break}return t.chartLoading=!0,e.n=1,Object(d["b"])(t.queryParams);case 1:a=e.v,i=a.rows,n=[],o=[],i.forEach((function(t){n.push(t.time),o.push(t.value)})),m["chartOption"].xAxis.data=n,m["chartOption"].series[0].data=o,t.chartLoading=!1,t.myChart=t.$echarts.init(t.$refs.chart),t.myChart.setOption(m["chartOption"]);case 2:return e.a(2)}}),e)})))()},beginMonitor:function(){3==this.device.status?(this.mqttPublish({name:"更新实时监测",type:4,message:'{"interval":1000}'}),this.isMonitor=!0):this.$modal.alertError("设备不在线，下发指令失败")},stopMonitor:function(){3==this.device.status?(this.mqttPublish({name:"关闭实时监测",type:4,message:'{"interval":0}'}),this.isMonitor=!1):this.$modal.alertError("设备不在线，下发指令失败")}}},f=b,y=(a("1a85"),a("2877")),g=Object(y["a"])(f,i,n,!1,null,"396d03e6",null);e["default"]=g.exports},"38be":function(t,e,a){"use strict";a.r(e),a.d(e,"chartOption",(function(){return i}));var i={tooltip:{trigger:"axis"},title:{text:"",left:"center"},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:[1,2,3,4,5,6,7,8,9,10,11,12]},yAxis:{type:"value",boundaryGap:[0,"100%"]},dataZoom:[{type:"slider",start:0,end:100}],grid:{left:0,right:0,top:40},series:[{name:"",type:"line",symbol:"none",sampling:"lttb",itemStyle:{color:"#2b7"},smooth:!0,data:[11,34,41,35,16,25,34,19,20,32,24]}]}},a035:function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return o}));var i=a("b775");function n(t){return Object(i["a"])({url:"/iot/deviceLog/list",method:"get",params:t})}function o(t){return Object(i["a"])({url:"/iot/deviceLog/monitor",method:"get",params:t})}},af64:function(t,e,a){},e350:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));a("caad"),a("d3b7"),a("2532"),a("0643"),a("9a9a");var i=a("4360");function n(t){if(t&&t instanceof Array&&t.length>0){var e=i["a"].getters&&i["a"].getters.permissions,a=t,n="*:*:*",o=e.some((function(t){return n===t||a.includes(t)}));return!!o}return console.error("need roles! Like checkPermi=\"['system:user:add','system:user:edit']\""),!1}}}]);