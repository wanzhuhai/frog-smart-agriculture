(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-aaebedec","chunk-6a90d438","chunk-5d792ca1","chunk-1022b97a","chunk-2f2532c4","chunk-2d0a3715","chunk-2d0bae5e","chunk-2d0c0c57"],{"01ca":function(e,t,i){"use strict";i.d(t,"f",(function(){return n})),i.d(t,"d",(function(){return s})),i.d(t,"a",(function(){return r})),i.d(t,"e",(function(){return o})),i.d(t,"g",(function(){return l})),i.d(t,"c",(function(){return d})),i.d(t,"b",(function(){return c}));var a=i("b775");function n(e){return Object(a["a"])({url:"/iot/model/list",method:"get",params:e})}function s(e){return Object(a["a"])({url:"/iot/model/"+e,method:"get"})}function r(e){return Object(a["a"])({url:"/iot/model",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/iot/model/import",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/iot/model",method:"put",data:e})}function d(e){return Object(a["a"])({url:"/iot/model/"+e,method:"delete"})}function c(e){return Object(a["a"])({url:"/iot/model/cache/"+e,method:"get"})}},"1a85":function(e,t,i){"use strict";i("af64")},2544:function(e,t,i){"use strict";i.d(t,"e",(function(){return n})),i.d(t,"d",(function(){return s})),i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return o})),i.d(t,"f",(function(){return l})),i.d(t,"c",(function(){return d}));var a=i("b775");function n(e){return Object(a["a"])({url:"/iot/deviceUser/list",method:"get",params:e})}function s(e,t){return Object(a["a"])({url:"/iot/deviceUser/"+e+"/"+t,method:"get"})}function r(e){return Object(a["a"])({url:"/iot/deviceUser",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/iot/deviceUser/addDeviceUsers",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/iot/deviceUser",method:"put",data:e})}function d(e){return Object(a["a"])({url:"/iot/deviceUser",method:"delete",data:e})}},"340d":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"h100"},[e.draggable?e._e():i("el-button",{staticClass:"margin-top-10 position-absolute right-120",attrs:{type:"primary",size:"mini",loading:e.loading,disabled:!e.checkPermi(["agriculture:layout:add"])},on:{click:function(t){e.draggable=!0}}},[e._v("更改节点排版")]),e.draggable?i("el-button-group",{staticClass:"margin-top-10 position-absolute right-120"},[i("el-button",{attrs:{type:"warning",size:"mini",disabled:!e.resetBtn},on:{click:e.handleReset}},[e._v("复位")]),i("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(t){e.draggable=!1}}},[e._v("取消")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleSave}},[e._v("保存")])],1):e._e(),e.isMonitor?e._e():i("el-button",{staticClass:"margin-top-10 position-absolute right-30",attrs:{type:"warning",size:"mini",loading:e.loading,disabled:!e.checkPermi(["device:view:monitor"])},on:{click:e.beginMonitor}},[e._v("实时数据")]),e.isMonitor?i("el-button",{staticClass:"margin-top-10 position-absolute right-30 ",attrs:{type:"danger",size:"mini",loading:e.loading},on:{click:e.stopMonitor}},[e._v("关闭实时")]):e._e(),e.layout.img?i("vue-draggable-resizable",{attrs:{resizable:e.draggable,draggable:e.draggable,"class-name":"original",x:Number(e.layout.img.x),y:Number(e.layout.img.y),w:Number(e.layout.img.w),h:Number(e.layout.img.h)},on:{dragstop:function(t){return e.handleDragstop(arguments,"img")},resizestop:function(t){return e.handleResizestop(arguments,"img")}}},[i("el-image",{staticClass:"w100 h100",attrs:{src:e.device.imgUrl?e.$baseUrl+e.device.imgUrl.split(",")[0]:"",fit:"fill",lazy:!0}})],1):e._e(),e._l(e.layout.monitorList,(function(t){return i("vue-draggable-resizable",{key:t.identifier,staticClass:"border-radius-20",attrs:{"class-name":"original","class-name-draggable":"draggable","class-name-dragging":"dragging",h:"auto",w:"auto",x:Number(t.x),y:Number(t.y),resizable:!1,draggable:e.draggable,parent:!0},on:{dragstop:function(i){return e.handleDragstop(arguments,t.identifier)}}},[i("div",{staticClass:"inline-flex border-d8d8d8 border-radius-20 aic",on:{dblclick:function(i){return e.handleChartClick(t.identifier)}}},[i("div",{staticClass:"width-35 height-35 border-radius-20 flex aic jcc",style:{backgroundColor:t.color}},[i("svg-icon",{staticClass:"font-size-20 font-color-fff",attrs:{"icon-class":t.icon}})],1),i("span",{staticClass:"padding-lr-10 font-color-l1 font-size-14"},[e._v(e._s(t.name))]),i("span",{staticClass:"padding-right-10 font-color-l1 font-size-14"},[i("span",{staticClass:"font-weight-bold font-size-17"},[e._v(e._s(t.value))]),i("span",{staticClass:"margin-left-5"},[e._v(e._s(t.unit))])])])])})),e._l(e.layout.controlList,(function(t){return i("vue-draggable-resizable",{key:t.identifier,staticClass:"border-radius-10",attrs:{"class-name":"original","class-name-draggable":"draggable","class-name-dragging":"dragging",h:"auto",w:"auto",x:Number(t.x),y:Number(t.y),resizable:!1,draggable:e.draggable,parent:!0},on:{dragstop:function(i){return e.handleDragstop(arguments,t.identifier)}}},[i("div",{staticClass:"flex aic width-250 height-100 border-radius-10",staticStyle:{"background-color":"#fbfafa"}},[i("div",{staticClass:"margin-lr-15 width-50 height-50 border-radius-30 flex aic jcc",style:{backgroundColor:t.color}},[i("svg-icon",{staticClass:"font-size-20 font-color-fff",attrs:{"icon-class":"control"}})],1),i("div",{staticClass:"flex fdc height-60 jcsa"},[i("span",{staticClass:"font-size-14"},[e._v(e._s(t.name))]),i("div",{staticClass:"width-150"},["bool"==t.dataType.type?i("div",[i("el-switch",{staticStyle:{"min-width":"100px"},attrs:{size:"mini","active-text":"","inactive-text":"","active-value":"1","inactive-value":"0",disabled:e.shadowUnEnable||1==t.isReadonly},on:{change:function(i){return e.mqttPublish(t)}},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}})],1):e._e(),"enum"==t.dataType.type?i("div",[i("el-select",{attrs:{size:"mini",placeholder:"请选择",disabled:e.shadowUnEnable||1==t.isReadonly},on:{change:function(i){return e.mqttPublish(t)}},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},e._l(t.dataType.enumList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1):e._e(),"string"==t.dataType.type?i("div",[i("el-input",{attrs:{placeholder:"请输入字符串 "+(t.dataType.unit?"，单位："+t.dataType.unit:""),disabled:e.shadowUnEnable||1==t.isReadonly},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[e.shadowUnEnable||0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.mqttPublish(t)}},slot:"append"})],1)],1):e._e(),"decimal"==t.dataType.type?i("div",[i("el-input",{attrs:{type:"number",placeholder:"请输入小数 "+(t.dataType.unit?"，单位："+t.dataType.unit:""),disabled:e.shadowUnEnable||1==t.isReadonly},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[e.shadowUnEnable||0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.mqttPublish(t)}},slot:"append"})],1)],1):e._e(),"integer"==t.dataType.type?i("div",[i("el-input",{attrs:{type:"integer",placeholder:"请输入整数 "+(t.dataType.unit?"，单位："+t.dataType.unit:""),disabled:e.shadowUnEnable||1==t.isReadonly},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[e.shadowUnEnable||0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.mqttPublish(t)}},slot:"append"})],1)],1):e._e(),"object"==t.dataType.type?i("div",[i("el-descriptions",{attrs:{column:1,size:"mini",border:""}},e._l(t.dataType.params,(function(t,a){return i("el-descriptions-item",{key:a,attrs:{label:t.name}},["bool"==t.dataType.type?i("div",[i("el-switch",{staticStyle:{"min-width":"100px"},attrs:{"active-text":"","inactive-text":"","active-value":"1","inactive-value":"0",disabled:e.shadowUnEnable||1==t.isReadonly},on:{change:function(i){return e.mqttPublish(t)}},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"param.shadow"}})],1):e._e(),"enum"==t.dataType.type?i("div",[i("el-select",{attrs:{placeholder:"请选择",disabled:e.shadowUnEnable||1==t.isReadonly},on:{change:function(i){return e.mqttPublish(t)}},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"param.shadow"}},e._l(t.dataType.enumList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1):e._e(),"string"==t.dataType.type?i("div",[i("el-input",{attrs:{placeholder:"请输入字符串",disabled:e.shadowUnEnable||1==t.isReadonly},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"param.shadow"}},[e.shadowUnEnable||0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.mqttPublish(t)}},slot:"append"})],1)],1):e._e(),"decimal"==t.dataType.type?i("div",[i("el-input",{attrs:{type:"number",placeholder:"请输入小数 ",disabled:e.shadowUnEnable||1==t.isReadonly},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"param.shadow"}},[e.shadowUnEnable||0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.mqttPublish(t)}},slot:"append"})],1)],1):e._e(),"integer"==t.dataType.type?i("div",[i("el-input",{attrs:{type:"integer",placeholder:"请输入整数 ",disabled:e.shadowUnEnable||1==t.isReadonly},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"param.shadow"}},[e.shadowUnEnable||0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.mqttPublish(t)}},slot:"append"})],1)],1):e._e()])})),1)],1):e._e(),"array"==t.dataType.type?i("div",["object"!=t.dataType.arrayType?i("el-descriptions",{attrs:{column:1,size:"mini",border:""}},e._l(t.dataType.arrayModel,(function(a,n){return i("el-descriptions-item",{key:n,attrs:{label:t.name+(n+1)}},["string"==t.dataType.arrayType?i("div",[i("el-input",{attrs:{placeholder:"请输入字符串",size:"mini",disabled:e.shadowUnEnable||1==t.isReadonly},on:{input:function(i){return e.arrayItemChange(i,t)}},model:{value:a.shadow,callback:function(t){e.$set(a,"shadow",t)},expression:"model.shadow"}},[e.shadowUnEnable&&0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(t){return e.mqttPublish(a)}},slot:"append"})],1)],1):e._e(),"decimal"==t.dataType.arrayType?i("div",[i("el-input",{attrs:{type:"number",placeholder:"请输入小数 ",size:"mini",disabled:e.shadowUnEnable||1==t.isReadonly},on:{input:function(i){return e.arrayItemChange(i,t)}},model:{value:a.shadow,callback:function(t){e.$set(a,"shadow",t)},expression:"model.shadow"}},[e.shadowUnEnable&&0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(t){return e.mqttPublish(a)}},slot:"append"})],1)],1):e._e(),"integer"==t.dataType.arrayType?i("div",[i("el-input",{attrs:{type:"integer",placeholder:"请输入整数 ",size:"mini",disabled:e.shadowUnEnable||1==t.isReadonly},on:{input:function(i){return e.arrayItemChange(i,t)}},model:{value:a.shadow,callback:function(t){e.$set(a,"shadow",t)},expression:"model.shadow"}},[e.shadowUnEnable&&0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(t){return e.mqttPublish(a)}},slot:"append"})],1)],1):e._e()])})),1):e._e(),"object"==t.dataType.arrayType?i("el-collapse",e._l(t.dataType.arrayParams,(function(a,n){return i("el-collapse-item",{key:n},[i("template",{slot:"title"},[i("span",{staticStyle:{color:"#666"}},[i("i",{staticClass:"el-icon-tickets"}),e._v(" "+e._s(t.name+(n+1)))])]),i("el-descriptions",{attrs:{column:1,size:"mini",border:""}},e._l(a,(function(t,a){return i("el-descriptions-item",{key:a,attrs:{label:t.name}},["bool"==t.dataType.type?i("div",[i("el-switch",{staticStyle:{"min-width":"100px"},attrs:{"active-text":"","inactive-text":"","active-value":"1","inactive-value":"0",disabled:e.shadowUnEnable||1==t.isReadonly},on:{change:function(i){return e.mqttPublish(t)}},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"param.shadow"}})],1):e._e(),"enum"==t.dataType.type?i("div",[i("el-select",{attrs:{placeholder:"请选择",disabled:e.shadowUnEnable||1==t.isReadonly},on:{change:function(i){return e.mqttPublish(t)}},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"param.shadow"}},e._l(t.dataType.enumList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1):e._e(),"string"==t.dataType.type?i("div",[i("el-input",{attrs:{placeholder:"请输入字符串",disabled:e.shadowUnEnable||1==t.isReadonly},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"param.shadow"}},[e.shadowUnEnable||0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.mqttPublish(t)}},slot:"append"})],1)],1):e._e(),"decimal"==t.dataType.type?i("div",[i("el-input",{attrs:{type:"number",placeholder:"请输入小数 ",disabled:e.shadowUnEnable||1==t.isReadonly},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"param.shadow"}},[e.shadowUnEnable||0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.mqttPublish(t)}},slot:"append"})],1)],1):e._e(),"integer"==t.dataType.type?i("div",[i("el-input",{attrs:{type:"integer",placeholder:"请输入整数 ",disabled:e.shadowUnEnable||1==t.isReadonly},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"param.shadow"}},[e.shadowUnEnable||0!=t.isReadonly?e._e():i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.mqttPublish(t)}},slot:"append"})],1)],1):e._e()])})),1)],2)})),1):e._e()],1):e._e()])])])])})),e.dialogVisible?i("el-dialog",{attrs:{title:"历史记录",visible:e.dialogVisible,width:"50%","close-on-click-modal":!1,modal:!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",{staticClass:"flex jcsb"},[i("el-date-picker",{attrs:{type:"daterange","range-separator":"—","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",size:"mini"},model:{value:e.daterangeTime,callback:function(t){e.daterangeTime=t},expression:"daterangeTime"}})],1),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.chartLoading,expression:"chartLoading"}],ref:"chart",staticClass:"w100 height-300"})]):e._e()],2)},n=[],s=i("2909"),r=i("c14f"),o=i("1da1"),l=(i("99af"),i("7db0"),i("d81d"),i("b0c0"),i("b64b"),i("d3b7"),i("25f0"),i("0643"),i("fffc"),i("4e3e"),i("a573"),i("159b"),i("e350")),d=i("a035"),c=i("b775");function u(e){return Object(c["a"])({url:"/agriculture/layout/list",method:"get",params:e})}function h(e){return Object(c["a"])({url:"/agriculture/layout",method:"post",data:e})}function p(e){return Object(c["a"])({url:"/agriculture/layout/"+e,method:"delete"})}var m=i("38be"),f={name:"",mixins:[],components:{},props:{device:{type:Object}},data:function(){return{loading:!1,draggable:!1,layoutList:[],layout:{monitorList:[],controlList:[],img:null},formLayoutList:[],imgLayout:{x:300,y:10,w:300,h:400},daterangeTime:null,queryParams:{serialNumber:null,identity:"",total:200},chartLoading:!1,dialogVisible:!1,isMonitor:!1,resetBtn:!0,shadowUnEnable:!1}},computed:{},watch:{device:{handler:function(){var e=Object(o["a"])(Object(r["a"])().m((function e(t,i){return Object(r["a"])().w((function(e){while(1)switch(e.n){case 0:if(!t.productId||!t.serialNumber){e.n=2;break}return e.n=1,this.getLayoutList();case 1:this.formatLayout(),this.connectMqtt();case 2:return e.a(2)}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}(),immediate:!0},daterangeTime:{handler:function(){this.initChart()},deep:!0}},created:function(){},mounted:function(){},destroyed:function(){},methods:{checkPermi:l["a"],getLayoutList:function(){var e=this;return Object(o["a"])(Object(r["a"])().m((function t(){var i,a,n;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:if(i=e.device.productId,!i){t.n=2;break}return t.n=1,u({productId:i});case 1:a=t.v,n=a.rows,e.layoutList=n,n.length>0&&(e.resetBtn=!0);case 2:return t.a(2)}}),t)})))()},formatLayout:function(){var e=this,t=this.device.productId;this.device.monitorList&&this.device.monitorList.length>0&&(this.layout.monitorList=this.device.monitorList.map((function(i,a){return{productId:t,identifier:i.id,icon:i.id,name:i.name,value:i.value?i.value:"-",unit:i.dataType.unit,color:e.$colorList[a],x:e.layoutList.find((function(e){return e.identifier==i.id}))?e.layoutList.find((function(e){return e.identifier==i.id})).x:0,y:e.layoutList.find((function(e){return e.identifier==i.id}))?e.layoutList.find((function(e){return e.identifier==i.id})).y:50*a+10,w:"auto",h:"auto"}}))),this.device.thingsModels&&this.device.thingsModels.length>0&&(this.layout.controlList=this.device.thingsModels.map((function(i,a){return{productId:t,identifier:i.id,icon:i.id,name:i.name,value:i.value?i.value:"-",unit:i.dataType.unit,color:e.$colorList[a],x:e.layoutList.find((function(e){return e.identifier==i.id}))?e.layoutList.find((function(e){return e.identifier==i.id})).x:600,y:e.layoutList.find((function(e){return e.identifier==i.id}))?e.layoutList.find((function(e){return e.identifier==i.id})).y:120*a+10,w:"auto",h:"auto",dataType:i.dataType,id:i.id,shadow:i.shadow,type:i.type}}))),this.layout.img={productId:t,identifier:"img",x:this.layoutList.find((function(e){return"img"==e.identifier}))?this.layoutList.find((function(e){return"img"==e.identifier})).x:300,y:this.layoutList.find((function(e){return"img"==e.identifier}))?this.layoutList.find((function(e){return"img"==e.identifier})).y:200,w:this.layoutList.find((function(e){return"img"==e.identifier}))?this.layoutList.find((function(e){return"img"==e.identifier})).w:200,h:this.layoutList.find((function(e){return"img"==e.identifier}))?this.layoutList.find((function(e){return"img"==e.identifier})).h:300}},handleDragstop:function(e,t){this.setValue(e,t)},handleResizestop:function(e,t){console.log(e),this.setValue(e,t)},setValue:function(e,t){console.log(t);for(var i=0;i<this.layout.monitorList.length;i++)this.layout.monitorList[i].identifier==t&&(this.layout.monitorList[i].x=e[0],this.layout.monitorList[i].y=e[1],4==e.length&&(this.layout.monitorList[i].w=e[2],this.layout.monitorList[i].h=e[3]));for(var a=0;a<this.layout.controlList.length;a++)this.layout.controlList[a].identifier==t&&(this.layout.controlList[a].x=e[0],this.layout.controlList[a].y=e[1],4==e.length&&(this.layout.controlList[a].w=e[2],this.layout.controlList[a].h=e[3]));"img"==t&&(this.layout.img.x=e[0],this.layout.img.y=e[1],4==e.length&&(this.layout.img.w=e[2],this.layout.img.h=e[3]))},handleSave:function(){var e=this;return Object(o["a"])(Object(r["a"])().m((function t(){var i,a,n,o,l;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:if(i=e.layout,a=i.monitorList,n=i.controlList,o=i.img,l=[].concat(Object(s["a"])(a),Object(s["a"])(n),[o]),console.log(l),!(l.length>0)){t.n=2;break}return e.loading=!0,t.n=1,h(l);case 1:e.$modal.msgSuccess("保存成功"),e.loading=!1,e.draggable=!1;case 2:return t.a(2)}}),t)})))()},handleReset:function(){var e=this;return Object(o["a"])(Object(r["a"])().m((function t(){var i;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:if(e.loading=!0,i=e.device.productId,!i){t.n=4;break}return t.n=1,p(i);case 1:return t.n=2,e.getLayoutList();case 2:return t.n=3,e.formatLayout();case 3:e.$modal.msgSuccess("重置成功"),e.loading=!1,e.draggable=!1;case 4:return t.a(2)}}),t)})))()},connectMqtt:function(){var e=this;return Object(o["a"])(Object(r["a"])().m((function t(){return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:if(null!=e.$mqttTool.client){t.n=1;break}return t.n=1,e.$mqttTool.connect();case 1:e.mqttSubscribe(),e.mqttCallback();case 2:return t.a(2)}}),t)})))()},mqttCallback:function(){var e=this;this.$mqttTool.client.on("message",(function(t,i,a){var n=JSON.parse(i.toString()),s=e.layout.monitorList;if(s.length>0)for(var r=0;r<s.length;r++)for(var o=0;o<n.length;o++)s[r].identifier==n[o].id&&(s[r].value=n[o].value)}))},mqttSubscribe:function(){var e=this.device,t="/"+e.productId+"/"+e.serialNumber+"/status/post",i="/"+e.productId+"/"+e.serialNumber+"/property/post",a="/"+e.productId+"/"+e.serialNumber+"/function/post",n="/"+e.productId+"/"+e.serialNumber+"/monitor/post",s=[];s.push(t),s.push(i),s.push(a),s.push(n),this.$mqttTool.subscribe(s)},mqttPublish:function(e){var t=this,i="",a="",n=this.device;switch(e.type){case 1:3==n.status?i="/"+n.productId+"/"+n.serialNumber+"/property-online/get":n.isShadow&&(i="/"+n.productId+"/"+n.serialNumber+"/property-offline/post"),a='{"id":"'.concat(e.id,'","value":"').concat(e.shadow,'"}');break;case 2:3==n.status?i="/"+n.productId+"/"+n.serialNumber+"/function-online/get":n.isShadow&&(i="/"+n.productId+"/"+n.serialNumber+"/function-offline/post"),a='[{"id":"'.concat(e.id,'","value":"').concat(e.shadow,'","remark":"设备控制"}]');break;case 3:i="/"+n.productId+"/"+n.serialNumber+"/ota/get",a='{"version":'+this.firmware.version+',"downloadUrl":"'+this.getDownloadUrl(this.firmware.filePath)+'"}';break;case 4:i="/"+n.productId+"/"+n.serialNumber+"/monitor/get",a=e.message;break;default:break}""!=i&&this.$mqttTool.publish(i,a,e.name).then((function(e){t.$modal.notifySuccess(e)})).catch((function(e){t.$modal.notifyError(e)}))},handleChartClick:function(e){this.dialogVisible=!0,this.queryParams.identity=e,this.initChart()},initChart:function(){var e=this;return Object(o["a"])(Object(r["a"])().m((function t(){var i,a,n,s;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:if(e.queryParams.serialNumber=e.device.serialNumber,e.daterangeTime&&(e.queryParams.beginTime=e.daterangeTime[0],e.queryParams.endTime=e.daterangeTime[1]+" 23:59"),!String(e.queryParams.identity)){t.n=2;break}return e.chartLoading=!0,t.n=1,Object(d["b"])(e.queryParams);case 1:i=t.v,a=i.rows,n=[],s=[],a.forEach((function(e){n.push(e.time),s.push(e.value)})),m["chartOption"].xAxis.data=n,m["chartOption"].series[0].data=s,e.chartLoading=!1,e.myChart=e.$echarts.init(e.$refs.chart),e.myChart.setOption(m["chartOption"]);case 2:return t.a(2)}}),t)})))()},beginMonitor:function(){3==this.device.status?(this.mqttPublish({name:"更新实时监测",type:4,message:'{"interval":1000}'}),this.isMonitor=!0):this.$modal.alertError("设备不在线，下发指令失败")},stopMonitor:function(){3==this.device.status?(this.mqttPublish({name:"关闭实时监测",type:4,message:'{"interval":0}'}),this.isMonitor=!1):this.$modal.alertError("设备不在线，下发指令失败")}}},g=f,y=(i("1a85"),i("2877")),b=Object(y["a"])(g,a,n,!1,null,"396d03e6",null);t["default"]=b.exports},"38be":function(e,t,i){"use strict";i.r(t),i.d(t,"chartOption",(function(){return a}));var a={tooltip:{trigger:"axis"},title:{text:"",left:"center"},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:[1,2,3,4,5,6,7,8,9,10,11,12]},yAxis:{type:"value",boundaryGap:[0,"100%"]},dataZoom:[{type:"slider",start:0,end:100}],grid:{left:0,right:0,top:40},series:[{name:"",type:"line",symbol:"none",sampling:"lttb",itemStyle:{color:"#2b7"},smooth:!0,data:[11,34,41,35,16,25,34,19,20,32,24]}]}},"3cb7":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("device-view",{attrs:{deviceId:e.deviceId},scopedSlots:e._u([{key:"p1",fn:function(e){var t=e.device;return[i("cd-detail",{attrs:{device:t}})]}}])})],1)},n=[],s=(i("a9e3"),i("a268")),r=i("340d"),o={name:"VenturiWm",mixins:[],components:{DeviceView:s["default"],CdDetail:r["default"]},props:{deviceId:[Number,String]},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},destroyed:function(){},methods:{}},l=o,d=i("2877"),c=Object(d["a"])(l,a,n,!1,null,"ff374a32",null);t["default"]=c.exports},"42cf":function(e,t,i){"use strict";i.r(t),i.d(t,"formatThingsModel",(function(){return a}));i("a434"),i("b0c0");function a(e){console.log("deviceinfo",e);e.monitorList=[];for(var t=0;t<e.thingsModels.length;t++)if("array"==e.thingsModels[t].dataType.type)if("object"==e.thingsModels[t].dataType.arrayType)for(var i=0;i<e.thingsModels[t].dataType.arrayParams.length;i++)for(var a=0;a<e.thingsModels[t].dataType.arrayParams[i].length;a++){var n=i>9?String(i):"0"+i,s="array_"+n+"_";e.thingsModels[t].dataType.arrayParams[i][a].id=s+e.thingsModels[t].dataType.arrayParams[i][a].id,1==e.thingsModels[t].dataType.arrayParams[i][a].isMonitor&&(e.thingsModels[t].dataType.arrayParams[i][a].name="["+e.thingsModels[t].name+(i+1)+"] "+e.thingsModels[t].dataType.arrayParams[i][a].name,e.thingsModels[t].dataType.arrayParams[i][a].dataType.arrayType="object",e.monitorList.push(e.thingsModels[t].dataType.arrayParams[i][a]),e.thingsModels[t].dataType.arrayParams[i].splice(a--,1))}else for(var r=""!=e.thingsModels[t].value?e.thingsModels[t].value.split(","):[],o=""!=e.thingsModels[t].shadow?e.thingsModels[t].shadow.split(","):[],l=0;l<e.thingsModels[t].dataType.arrayCount;l++){e.thingsModels[t].dataType.arrayModel||(e.thingsModels[t].dataType.arrayModel=[]);var d=l>9?String(l):"0"+l,c="array_"+d+"_";e.thingsModels[t].dataType.arrayModel[l]={id:c+e.thingsModels[t].id,name:e.thingsModels[t].name,type:e.thingsModels[t].type,isReadonly:e.thingsModels[t].isReadonly,value:r[l]?r[l]:"",shadow:o[l]?o[l]:""}}else if("object"==e.thingsModels[t].dataType.type)for(var u=0;u<e.thingsModels[t].dataType.params.length;u++)1==e.thingsModels[t].dataType.params[u].isMonitor&&(e.thingsModels[t].dataType.params[u].name="["+e.thingsModels[t].name+"] "+e.thingsModels[t].dataType.params[u].name,e.monitorList.push(e.thingsModels[t].dataType.params[u]),e.thingsModels[t].dataType.params.splice(u--,1));else 1==e.thingsModels[t].isMonitor&&(e.monitorList.push(e.thingsModels[t]),e.thingsModels.splice(t--,1))}},"4c26":function(e,t,i){},"6f3e":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));i("a4d3"),i("e01a"),i("d28b"),i("d3b7"),i("3ca3"),i("ddb0");var a=i("53ca");function n(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],i=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}}}throw new TypeError(Object(a["a"])(e)+" is not iterable")}},7168:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[i("el-form-item",{attrs:{label:"日志类型",prop:"logType"}},[i("el-select",{attrs:{placeholder:"请选择类型",clearable:"",size:"small"},model:{value:e.queryParams.logType,callback:function(t){e.$set(e.queryParams,"logType",t)},expression:"queryParams.logType"}},e._l(e.dict.type.iot_device_log_type,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",{attrs:{label:"标识符",prop:"identity"}},[i("el-input",{attrs:{placeholder:"请输入标识符",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.identity,callback:function(t){e.$set(e.queryParams,"identity",t)},expression:"queryParams.identity"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.deviceLogList,size:"mini"}},[i("el-table-column",{attrs:{label:"类型",align:"center",prop:"logType",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_device_log_type,value:t.row.logType}})]}}])}),i("el-table-column",{attrs:{label:"模式",align:"center",prop:"logType",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.mode?i("el-tag",{attrs:{type:"primary"}},[e._v("影子模式")]):2==t.row.mode?i("el-tag",{attrs:{type:"success"}},[e._v("在线模式")]):i("el-tag",{attrs:{type:"info"}},[e._v("其他信息")])]}}])}),i("el-table-column",{attrs:{label:"时间",align:"center",prop:"createTime",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.createTime))])]}}])}),i("el-table-column",{attrs:{label:"标识符",align:"center",prop:"identity"}}),i("el-table-column",{attrs:{label:"动作",align:"left","header-align":"center",prop:"logValue"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{domProps:{innerHTML:e._s(e.formatValueDisplay(t.row))}})]}}])}),i("el-table-column",{attrs:{label:"备注","header-align":"center",align:"left",prop:"remark"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(null==t.row.remark?"无":t.row.remark)+" ")]}}])})],1),i("div",{staticStyle:{height:"40px"}},[i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1)],1)},n=[],s=i("5530"),r=(i("b0c0"),i("a9e3"),i("a035")),o={name:"DeviceLog",dicts:["iot_device_log_type","iot_yes_no"],props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e,this.deviceInfo&&0!=this.deviceInfo.deviceId&&(this.queryParams.serialNumber=this.deviceInfo.serialNumber,this.getList(),this.thingsModel=this.deviceInfo.cacheThingsModel)}},data:function(){return{thingsModel:{},loading:!0,showSearch:!0,total:0,deviceLogList:[],queryParams:{pageNum:1,pageSize:10,logType:null,logValue:null,deviceId:null,serialNumber:null,deviceName:null,identity:null,isMonitor:null}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(r["a"])(this.queryParams).then((function(t){e.deviceLogList=t.rows,e.total=t.total,e.loading=!1}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleExport:function(){this.download("iot/deviceLog/export",Object(s["a"])({},this.queryParams),"deviceLog_".concat((new Date).getTime(),".xlsx"))},formatValueDisplay:function(e){if(1==e.logType){var t=this.getThingsModelItem(1,e.identity);if(""!=t)return(t.parentName?"["+t.parentName+(t.arrayIndex?t.arrayIndex:"")+"] ":"")+t.name+'： <span style="color:#409EFF;">'+this.getThingsModelItemValue(t,e.logValue)+" "+(void 0!=t.datatype.unit?t.datatype.unit:"")+"</span>"}else if(2==e.logType){var i=this.getThingsModelItem(2,e.identity);if(""!=i)return(i.parentName?"["+i.parentName+(i.arrayIndex?i.arrayIndex:"")+"] ":"")+i.name+'： <span style="color:#409EFF">'+this.getThingsModelItemValue(i,e.logValue)+" "+(void 0!=i.datatype.unit?i.datatype.unit:"")+"</span>"}else if(3==e.logType){var a=this.getThingsModelItem(3,e.identity);if(""!=a)return(a.parentName?"["+a.parentName+(a.arrayIndex?a.arrayIndex:"")+"] ":"")+a.name+'： <span style="color:#409EFF">'+this.getThingsModelItemValue(a,e.logValue)+" "+(void 0!=a.datatype.unit?a.datatype.unit:"")+"</span>"}else{if(4==e.logType)return'<span style="font-weight:bold">设备升级</span>';if(5==e.logType)return'<span style="font-weight:bold">设备上线</span>';if(6==e.logType)return'<span style="font-weight:bold">设备离线</span>'}return""},getThingsModelItemValue:function(e,t){if("bool"==e.datatype.type){if("0"==t)return e.datatype.falseText;if("1"==t)return e.datatype.trueText}else if("enum"==e.datatype.type)for(var i=0;i<e.datatype.enumList.length;i++)if(t==e.datatype.enumList[i].value)return e.datatype.enumList[i].text;return t},getThingsModelItem:function(e,t){if(1==e&&this.thingsModel.properties)for(var i=0;i<this.thingsModel.properties.length;i++){if(this.thingsModel.properties[i].id==t)return this.thingsModel.properties[i];if("object"==this.thingsModel.properties[i].datatype.type)for(var a=0;a<this.thingsModel.properties[i].datatype.params.length;a++)if(this.thingsModel.properties[i].datatype.params[a].id==t)return this.thingsModel.properties[i].datatype.params[a].parentName=this.thingsModel.properties[i].name,this.thingsModel.properties[i].datatype.params[a];if("array"==this.thingsModel.properties[i].datatype.type&&this.thingsModel.properties[i].datatype.arrayType)if("object"==this.thingsModel.properties[i].datatype.arrayType){var n=t,s=0;t.indexOf("array_")>-1&&(s=t.substring(6,8),n=t.substring(9));for(var r=0;r<this.thingsModel.properties[i].datatype.params.length;r++)if(this.thingsModel.properties[i].datatype.params[r].id==n)return this.thingsModel.properties[i].datatype.params[r].arrayIndex=Number(s)+1,this.thingsModel.properties[i].datatype.params[r].parentName=this.thingsModel.properties[i].name,this.thingsModel.properties[i].datatype.params[r]}else for(var o=0;o<this.thingsModel.properties[i].datatype.arrayCount.length;o++)if(this.thingsModel.properties[i].id==realIdentity)return this.thingsModel.properties[i].arrayIndex=Number(arrayIndex)+1,this.thingsModel.properties[i].parentName="元素",this.thingsModel.properties[i]}else if(2==e&&this.thingsModel.functions)for(var l=0;l<this.thingsModel.functions.length;l++){if(this.thingsModel.functions[l].id==t)return this.thingsModel.functions[l];if("object"==this.thingsModel.functions[l].datatype.type)for(var d=0;d<this.thingsModel.functions[l].datatype.params.length;d++)if(this.thingsModel.functions[l].datatype.params[d].id==t)return this.thingsModel.functions[l].datatype.params[d].parentName=this.thingsModel.functions[l].name,this.thingsModel.functions[l].datatype.params[d];if("array"==this.thingsModel.functions[l].datatype.type&&this.thingsModel.functions[l].datatype.arrayType){var c=t,u=0;if(t.indexOf("array_")>-1&&(u=t.substring(6,8),c=t.substring(9)),"object"==this.thingsModel.functions[l].datatype.arrayType){for(var h=0;h<this.thingsModel.functions[l].datatype.params.length;h++)if(this.thingsModel.functions[l].datatype.params[h].id==c)return this.thingsModel.functions[l].datatype.params[h].arrayIndex=Number(u)+1,this.thingsModel.functions[l].datatype.params[h].parentName=this.thingsModel.functions[l].name,this.thingsModel.functions[l].datatype.params[h]}else for(var p=0;p<this.thingsModel.functions[l].datatype.arrayCount.length;p++)if(this.thingsModel.functions[l].id==c)return this.thingsModel.functions[l].arrayIndex=Number(u)+1,this.thingsModel.functions[l].parentName="元素",this.thingsModel.functions[l]}}else if(3==e&&this.thingsModel.events)for(var m=0;m<this.thingsModel.events.length;m++)if(this.thingsModel.events[m].id==t)return this.thingsModel.events[m];return""}}},l=o,d=i("2877"),c=Object(d["a"])(l,a,n,!1,null,null,null);t["default"]=c.exports},"78f0":function(e,t,i){"use strict";i("4c26")},a035:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s}));var a=i("b775");function n(e){return Object(a["a"])({url:"/iot/deviceLog/list",method:"get",params:e})}function s(e){return Object(a["a"])({url:"/iot/deviceLog/monitor",method:"get",params:e})}},a268:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"header"},[i("div",{staticClass:"left"},[i("img",{staticClass:"img",attrs:{src:e.$baseUrl+e.device.imgUrl.split(",")[0],alt:""}})]),i("div",{staticClass:"right"},[i("div",{staticClass:"name"},[e._v(e._s(e.device&&e.device.deviceName))]),i("div",{staticClass:"des"},[i("span",[e._v("编号:")]),e._v(" "+e._s(e.device&&e.device.serialNumber)+" "),i("el-tag",{staticClass:"margin-left-10",attrs:{type:e.deviceStatus.color,size:"mini"}},[e._v(e._s(e.deviceStatus.title))])],1)])]),i("div",{staticClass:"body"},[i("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"采集数据",name:"p1"}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"content",class:{grey:e.grey,padding0:e.noPadding}},[e._t("p1",null,{device:e.device})],2)])]),i("el-tab-pane",{attrs:{label:"定时任务",name:"p2"}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"content"},[e._t("p2",[i("device-timer",{staticClass:"margin-top-20",attrs:{device:e.device}})])],2)])]),i("el-tab-pane",{attrs:{label:"设备用户",name:"p3"}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"content"},[e._t("p3",[i("device-user",{staticClass:"margin-top-20",attrs:{device:e.device}})])],2)])]),i("el-tab-pane",{attrs:{label:"设备日志",name:"p4"}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"content"},[e._t("p4",[i("device-log",{staticClass:"margin-top-20",attrs:{device:e.device}})])],2)])]),i("el-tab-pane",{attrs:{label:"数据分析",name:"p5"}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"content"},[e._t("p5",[i("device-statistic",{staticClass:"margin-top-20",attrs:{"chart-visible":e.chartVisible,device:e.device}})])],2)])]),e._t("tabs")],2)],1)])},n=[],s=i("c14f"),r=i("1da1"),o=(i("a9e3"),i("b64b"),i("d3b7"),i("3e47")),l=i("7a72"),d=i("b52e"),c=i("7168"),u=i("f14e"),h=i("584f"),p=i("01ca"),m=i("42cf"),f={name:"DeviceView",components:{DeviceForm:o["default"],DeviceTimer:l["default"],DeviceUser:d["default"],DeviceLog:c["default"],DeviceStatistic:u["default"]},props:{deviceId:[Number,String],grey:{type:Boolean,default:!1},noPadding:!1},data:function(){return{device:{imgUrl:""},activeName:"p1",chartVisible:!1}},computed:{deviceStatus:function(){var e=this.device;return 3==e.status?{title:"在线模式",color:"primary"}:1==e.isShadow?{title:"影子模式",color:"warning"}:{title:"离线模式",color:"danger"}}},created:function(){this.deviceId&&this.getDevice()},methods:{handleTabClick:function(e){"p5"==e.paneName&&(this.chartVisible=!0)},getDevice:function(){var e=this;return Object(r["a"])(Object(s["a"])().m((function t(){var i;return Object(s["a"])().w((function(t){while(1)switch(t.n){case 0:i=e.deviceId,Object(h["e"])(i).then(function(){var t=Object(r["a"])(Object(s["a"])().m((function t(a){return Object(s["a"])().w((function(t){while(1)switch(t.n){case 0:return t.n=1,e.getCacheThingsModdel(a.data.productId);case 1:return a.data.cacheThingsModel=t.v,t.n=2,e.getDeviceStatus(i);case 2:a.data.thingsModels=t.v,Object(m["formatThingsModel"])(a.data),e.device=a.data,null!=e.device.summary&&""!=e.device.summary&&(e.summary=JSON.parse(e.device.summary));case 3:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:return t.a(2)}}),t)})))()},getCacheThingsModdel:function(e){return new Promise((function(t,i){Object(p["b"])(e).then((function(e){t(JSON.parse(e.data))})).catch((function(e){i(e)}))}))},getDeviceStatus:function(e){return new Promise((function(t,i){Object(h["g"])(e).then((function(e){t(e.data.thingsModels)})).catch((function(e){i(e)}))}))}}},g=f,y=(i("78f0"),i("2877")),b=Object(y["a"])(g,a,n,!1,null,"072a94a4",null);t["default"]=b.exports},af64:function(e,t,i){},b52e:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",{staticClass:"mb8",attrs:{gutter:10}},[i("el-col",{attrs:{span:1.5}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:deviceshare:add"],expression:"['iot:deviceshare:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-share",size:"mini"},on:{click:e.selectUser}},[e._v("分享设备")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-refresh",size:"mini"},on:{click:e.getList}},[e._v("刷新")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.deviceUserList,size:"mini"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{label:"用户编号",align:"center",prop:"userId",width:"100"}}),i("el-table-column",{attrs:{label:"用户名称",align:"center",prop:"userName"}}),i("el-table-column",{attrs:{label:"手机号码",align:"center",prop:"phonenumber",width:"150"}}),i("el-table-column",{attrs:{label:"用户类型",align:"center",prop:"isOwner",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isOwner?i("el-tag",{attrs:{type:"primary"}},[e._v("主人")]):i("el-tag",{attrs:{type:"success"}},[e._v("分享")])]}}])}),i("el-table-column",{attrs:{label:"分享时间",align:"center",prop:"createTime",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime,"{y}-{m}-{d}")))])]}}])}),i("el-table-column",{attrs:{label:"备注",align:"left",prop:"remark","header-align":"center","min-width":"150"}}),i("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.isOwner&&e.checkPermi(["iot:deviceshare:edit"])&&e.checkPermi(["iot:deviceshare:remark"])&&e.checkPermi(["iot:deviceshare:query"])?i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(i){return e.handleUpdate(t.row)}}},[e._v("备注")]):e._e(),0==t.row.isOwner?i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:deviceshare:remove"],expression:"['iot:deviceshare:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("取消分享")]):e._e()]}}])})],1),i("el-dialog",{attrs:{title:e.title,visible:e.open,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",rows:"4"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}}),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),i("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),i("user-list",{ref:"userList",attrs:{device:e.devices}})],1)},n=[],s=i("5530"),r=(i("d81d"),i("b64b"),i("d3b7"),i("0643"),i("a573"),i("e350")),o=i("e018"),l=i("2544"),d={name:"device-user",dicts:["iot_yes_no"],components:{userList:o["default"]},props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e,this.devices=[e],this.deviceInfo&&0!=this.deviceInfo.deviceId&&(this.queryParams.deviceId=this.deviceInfo.deviceId,this.getList())}},data:function(){return{devices:[],loading:!0,ids:[],single:!0,multiple:!0,total:0,deviceUserList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,deviceName:null,userName:null,userId:null,tenantName:null,isOwner:null},form:{},rules:{deviceName:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],userName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}]}}},created:function(){Object.keys(this.device).length>0&&(this.queryParams.deviceId=this.device.deviceId,this.getList())},methods:{checkPermi:r["a"],getList:function(){var e=this;this.loading=!0,Object(l["e"])(this.queryParams).then((function(t){e.deviceUserList=t.rows,e.total=t.total,e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={deviceId:null,userId:null,deviceName:null,userName:null,tenantId:null,tenantName:null,isOwner:null,limitNum:null,delFlag:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.deviceId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="添加设备用户"},handleUpdate:function(e){var t=this;this.reset();var i=e.deviceId||this.ids;Object(l["d"])(i,e.userId).then((function(e){t.form=e.data,t.open=!0,t.title="用户备注"}))},submitForm:function(){var e=this;null!=this.form.deviceId&&Object(l["f"])(this.form).then((function(t){e.$modal.msgSuccess("备注成功"),e.open=!1,e.getList()}))},handleDelete:function(e){var t=this,i=e;this.$modal.confirm("确认取消分享设备？").then((function(){return Object(l["c"])(i)})).then((function(){t.getList(),t.$modal.msgSuccess("取消分享成功")})).catch((function(){}))},handleExport:function(){this.download("iot/deviceUser/export",Object(s["a"])({},this.queryParams),"deviceUser_".concat((new Date).getTime(),".xlsx"))},selectUser:function(){this.devices=[this.device],this.$refs.userList.openSelectUser=!0}}},c=d,u=i("2877"),h=Object(u["a"])(c,a,n,!1,null,null,null);t["default"]=h.exports},bb86:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return s}));var a=i("b775");i("bc3a"),i("5c96"),i("21a6"),i("5f87"),i("c38a");function n(e){return Object(a["a"])({url:"/iot/tool/register",headers:{isToken:!1},method:"post",data:e})}function s(e){return Object(a["a"])({url:"/iot/tool/userList",method:"get",params:e})}},e018:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"选择用户",visible:e.openSelectUser,width:"800px"},on:{"update:visible":function(t){e.openSelectUser=t}}},[i("div",{staticStyle:{"margin-top":"-50px"}},[i("el-divider")],1),i("el-form",{ref:"queryForm",attrs:{model:e.queryParams,rules:e.rules,inline:!0,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"手机号码",prop:"phonenumber"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{type:"text",placeholder:"请输入用户手机号码",minlength:"10",clearable:"",size:"small","show-word-limit":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.phonenumber,callback:function(t){e.$set(e.queryParams,"phonenumber",t)},expression:"queryParams.phonenumber"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("查询")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.userList,"highlight-current-row":"",size:"mini",border:""},on:{"current-change":e.handleCurrentChange}},[i("el-table-column",{attrs:{label:"选择",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("input",{attrs:{type:"radio",name:"user"},domProps:{checked:e.row.isSelect}})]}}])}),i("el-table-column",{key:"userId",attrs:{label:"用户编号",align:"center",prop:"userId",width:"120"}}),i("el-table-column",{key:"userName",attrs:{label:"用户名称",align:"center",prop:"userName"}}),i("el-table-column",{key:"nickName",attrs:{label:"用户昵称",align:"center",prop:"nickName"}}),i("el-table-column",{key:"phonenumber",attrs:{label:"手机号码",align:"center",prop:"phonenumber",width:"120"}}),i("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.addDeviceUser}},[e._v("分享")]),i("el-button",{on:{click:e.closeSelectUser}},[e._v("关 闭")])],1)],1)},n=[],s=(i("d3b7"),i("0643"),i("4e3e"),i("159b"),i("bb86")),r=i("2544"),o={name:"user-list",props:{device:{type:Array,default:null}},watch:{device:function(e,t){this.deviceInfo=e}},data:function(){return{loading:!1,ids:[],title:"",userList:[],user:{},deviceInfo:{},openSelectUser:!1,queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:0,deptId:void 0},rules:{phonenumber:[{required:!0,message:"手机号码不能为空",trigger:"blur"},{min:11,max:11,message:"手机号码长度为11位",trigger:"blur"}]}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(s["a"])(this.addDateRange(this.queryParams,this.dateRange)).then((function(t){e.userList=t.rows,e.total=t.total,e.loading=!1}))},handleQuery:function(){var e=this;this.$refs["queryForm"].validate((function(t){t&&(e.queryParams.pageNum=1,e.getList())}))},resetQuery:function(){this.$refs["queryForm"].resetFields(),this.userList=[]},setRadioSelected:function(e){for(var t=0;t<this.userList.length;t++)this.userList[t].userId==e?(this.userList[t].isSelect=!0,this.user=this.userList[t]):this.userList[t].isSelect=!1},handleCurrentChange:function(e){null!=e&&(this.setRadioSelected(e.userId),this.user=e)},closeSelectUser:function(){this.openSelectUser=!1,this.resetQuery()},addDeviceUser:function(){var e=this;if(null!=this.deviceInfo&&this.deviceInfo.length>0&&null!=this.user)if(1==this.deviceInfo.length){var t={};t.deviceId=this.deviceInfo[0].deviceId,t.deviceName=this.deviceInfo[0].deviceName,t.userId=this.user.userId,t.userName=this.user.userName,t.phonenumber=this.user.phonenumber,Object(r["a"])(t).then((function(t){e.$modal.msgSuccess("新增成功"),e.resetQuery(),e.openSelectUser=!1,e.$parent.getList()}))}else{t=[];this.deviceInfo.forEach((function(i){var a={};a.deviceId=i.deviceId,a.deviceName=i.deviceName,a.userId=e.user.userId,a.userName=e.user.userName,a.phonenumber=e.user.phonenumber,t.push(a)})),Object(r["b"])(t).then((function(t){e.$modal.msgSuccess("新增成功"),e.resetQuery(),e.openSelectUser=!1,e.$parent.getList()}))}else this.openSelectUser=!1}}},l=o,d=i("2877"),c=Object(d["a"])(l,a,n,!1,null,null,null);t["default"]=c.exports},f14e:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",[i("el-col",{attrs:{span:24}},[i("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"75px"}},[i("el-form-item",{attrs:{label:"时间范围"}},[i("el-date-picker",{staticStyle:{width:"240px"},attrs:{size:"small","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.daterangeTime,callback:function(t){e.daterangeTime=t},expression:"daterangeTime"}})],1),i("el-form-item",{attrs:{label:"最大数量"}},[i("el-input",{model:{value:e.queryParams.total,callback:function(t){e.$set(e.queryParams,"total",t)},expression:"queryParams.total"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.getStatisticData}},[e._v("查询")])],1)],1)],1),i("el-col",{attrs:{span:24}},e._l(e.monitorThings,(function(e,t){return i("div",{key:t,staticStyle:{"margin-bottom":"30px",width:"100%"}},[i("div",{ref:"statisticMap",refInFor:!0,staticStyle:{height:"300px",width:"100%"}})])})),0)],1)],1)},n=[],s=i("6f3e"),r=i("c14f"),o=i("1da1"),l=(i("b0c0"),i("3ca3"),i("ddb0"),i("a035")),d={name:"device-statistic",props:{device:{type:Object,default:null},chartVisible:{type:Boolean,default:!1}},watch:{device:function(e,t){this.deviceInfo=e,this.deviceInfo&&0!=this.deviceInfo.deviceId&&(this.monitorThings=this.deviceInfo.monitorList,this.$nextTick((function(){this.getStatistic(),this.getStatisticData(this.monitorThings)})))},chartVisible:{handler:function(e,t){if(e)for(var i=0;i<this.monitorThings.length;i++)this.chart[i].resize()}}},data:function(){return{deviceInfo:{},monitorThings:[],chart:[],daterangeTime:[],queryParams:{serialNumber:null,identity:"",total:50},arrayData:[]}},methods:{getStatisticData:function(){var e=this;return Object(o["a"])(Object(r["a"])().m((function t(){var i,a;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:i=Object(r["a"])().m((function t(i){return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:e.queryParams.serialNumber=e.deviceInfo.serialNumber,e.queryParams.identity=e.monitorThings[i].id,null!=e.daterangeTime&&""!=e.daterangeTime&&(e.queryParams.beginTime=e.daterangeTime[0],e.queryParams.endTime=e.daterangeTime[1]+" 23:59"),String(e.monitorThings[i].id)&&Object(l["b"])(e.queryParams).then((function(t){for(var a=t.rows,n=[],s=0;s<a.length;s++){var r=[];r[0]=a[s].time,r[1]=a[s].value,n.push(r)}e.chart[i].setOption({series:[{data:n}]})}));case 1:return t.a(2)}}),t)})),a=0;case 1:if(!(a<e.monitorThings.length)){t.n=3;break}return t.d(Object(s["a"])(i(a)),2);case 2:a++,t.n=1;break;case 3:return t.a(2)}}),t)})))()},getStatistic:function(){for(var e=["#1890FF","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],t=0;t<this.monitorThings.length;t++){var i;this.chart[t]=this.$echarts.init(this.$refs.statisticMap[t]),i={animationDurationUpdate:3e3,tooltip:{trigger:"axis"},title:{left:"center",text:this.monitorThings[t].name+"统计 （单位 "+(void 0!=this.monitorThings[t].dataType.unit?this.monitorThings[t].dataType.unit:"无")+"）"},grid:{top:"80px",left:"40px",right:"20px",bottom:"60px",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},xAxis:{type:"time"},yAxis:{type:"value"},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],series:[{name:this.monitorThings[t].name,type:"line",symbol:"none",sampling:"lttb",itemStyle:{color:t>9?e[0]:e[t]},areaStyle:{},data:[]}]},i&&this.chart[t].setOption(i)}}}},c=d,u=i("2877"),h=Object(u["a"])(c,a,n,!1,null,null,null);t["default"]=h.exports}}]);