(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-55af58da"],{"10f3":function(e,t,i){"use strict";i.d(t,"e",(function(){return r})),i.d(t,"d",(function(){return s})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){return l})),i.d(t,"g",(function(){return u})),i.d(t,"f",(function(){return o})),i.d(t,"b",(function(){return c}));var a=i("b775");function r(e){return Object(a["a"])({url:"/iot/group/list",method:"get",params:e})}function s(e){return Object(a["a"])({url:"/iot/group/"+e,method:"get"})}function n(e){return Object(a["a"])({url:"/iot/group/getDeviceIds/"+e,method:"get"})}function l(e){return Object(a["a"])({url:"/iot/group",method:"post",data:e})}function u(e){return Object(a["a"])({url:"/iot/group",method:"put",data:e})}function o(e){return Object(a["a"])({url:"/iot/group/updateDeviceGroups",method:"put",data:e})}function c(e){return Object(a["a"])({url:"/iot/group/"+e,method:"delete"})}},"95cf":function(e,t,i){},c572:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{padding:"6px"}},[i("el-card",{staticStyle:{"margin-bottom":"6px"}},[i("el-form",{ref:"queryForm",staticStyle:{"margin-bottom":"-20px"},attrs:{model:e.queryParams,inline:!0,"label-width":"75px"}},[i("el-form-item",{attrs:{label:"设备名称",prop:"deviceName"}},[i("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入设备名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.deviceName,callback:function(t){e.$set(e.queryParams,"deviceName",t)},expression:"queryParams.deviceName"}})],1),i("el-form-item",{attrs:{label:"设备编号",prop:"serialNumber"}},[i("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入设备编号",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.serialNumber,callback:function(t){e.$set(e.queryParams,"serialNumber",t)},expression:"queryParams.serialNumber"}})],1),i("el-form-item",{attrs:{label:"设备状态",prop:"status"}},[i("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择设备状态",clearable:"",size:"small"},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},e._l(e.dict.type.iot_device_status,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",{attrs:{label:"设备类型"}},[i("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择设备类型",clearable:"",size:"small"},model:{value:e.queryParams.deviceType,callback:function(t){e.$set(e.queryParams,"deviceType",t)},expression:"queryParams.deviceType"}},e._l(e.dict.type.iot_device_type,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:parseInt(e.value)}})})),1)],1),i("el-form-item",{attrs:{label:"分配地块"}},[i("el-select",{staticStyle:{width:"150px"},attrs:{size:"small",placeholder:"请选择地块"},model:{value:e.queryParams.landId,callback:function(t){e.$set(e.queryParams,"landId",t)},expression:"queryParams.landId"}},e._l(e.landList,(function(e){return i("el-option",{key:e.landId,attrs:{label:e.landName,value:e.landId}})})),1)],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1),i("el-form-item",{staticStyle:{float:"right"}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:add"],expression:"['iot:device:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAddDevice}},[e._v("新增")])],1)],1)],1),i("el-card",{staticStyle:{"padding-bottom":"100px"}},[i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{gutter:30}},e._l(e.deviceList,(function(t,a){return i("el-col",{key:a,staticStyle:{"margin-bottom":"30px","text-align":"center"},attrs:{xs:24,sm:12,md:12,lg:8,xl:6}},[i("el-card",{staticClass:"card-item",attrs:{"body-style":{padding:"20px"},shadow:"always"}},[i("el-row",{attrs:{type:"flex",gutter:10,justify:"space-between"}},[i("el-col",{staticStyle:{"text-align":"left"},attrs:{span:20}},[i("el-link",{staticStyle:{"font-weight":"bold","font-size":"16px","line-height":"32px"},attrs:{type:"",underline:!1},on:{click:function(i){return e.handleEditDevice(t)}}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"分享的设备",placement:"top-start"}},[1!=t.isOwner?i("svg-icon",{staticStyle:{"font-size":"20px"},attrs:{"icon-class":"share"}}):e._e()],1),1==t.isOwner?i("svg-icon",{attrs:{"icon-class":"device"}}):e._e(),i("span",{staticStyle:{margin:"0 5px"}},[e._v(e._s(t.deviceName))]),i("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("Ver "+e._s(t.firmwareVersion))])],1)],1),i("el-col",{attrs:{span:4}},[i("div",{staticStyle:{"font-size":"28px",color:"#ccc"}},[3==t.status&&t.rssi>="-55"?i("svg-icon",{attrs:{"icon-class":"wifi_4"}}):3==t.status&&t.rssi>="-70"&&t.rssi<"-55"?i("svg-icon",{attrs:{"icon-class":"wifi_3"}}):3==t.status&&t.rssi>="-85"&&t.rssi<"-70"?i("svg-icon",{attrs:{"icon-class":"wifi_2"}}):3==t.status&&t.rssi>="-100"&&t.rssi<"-85"?i("svg-icon",{attrs:{"icon-class":"wifi_1"}}):i("svg-icon",{attrs:{"icon-class":"wifi_0"}})],1)])],1),i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:15}},[i("div",{staticStyle:{"text-align":"left","line-height":"40px","white-space":"nowrap"}},[i("dict-tag",{staticStyle:{display:"inline-block"},attrs:{options:e.dict.type.iot_device_status,value:t.status,size:"small"}}),i("span",{staticStyle:{display:"inline-block",margin:"0 10px"}},[1==t.isShadow?i("el-tag",{attrs:{type:"success",size:"small"}},[e._v("影子")]):i("el-tag",{attrs:{type:"info",size:"small"}},[e._v("影子")])],1),i("dict-tag",{staticStyle:{display:"inline-block"},attrs:{options:e.dict.type.iot_location_way,value:t.locationWay,size:"small"}})],1),i("el-descriptions",{staticStyle:{"white-space":"nowrap"},attrs:{column:1,size:"mini"}},[i("el-descriptions-item",{attrs:{label:"编号"}},[e._v(" "+e._s(t.serialNumber)+" ")]),i("el-descriptions-item",{attrs:{label:"产品"}},[e._v(" "+e._s(t.productName)+" ")]),i("el-descriptions-item",{attrs:{label:"激活时间"}},[e._v(" "+e._s(e.parseTime(t.activeTime,"{y}-{m}-{d}"))+" ")])],1)],1),i("el-col",{attrs:{span:9}},[i("div",{staticStyle:{"margin-top":"10px"}},[null!=t.imgUrl&&""!=t.imgUrl?i("el-image",{staticStyle:{height:"100px","border-radius":"10px"},attrs:{lazy:"","preview-src-list":[e.baseUrl+t.imgUrl.split(",")[0]],src:e.baseUrl+t.imgUrl.split(",")[0],fit:"cover"}}):e._e()],1)])],1),i("el-button-group",{staticStyle:{"margin-top":"15px"}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:remove"],expression:"['iot:device:remove']"}],staticStyle:{padding:"5px 10px"},attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t)}}},[e._v("删除 ")]),i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:edit"],expression:"['iot:device:edit']"}],staticStyle:{padding:"5px 15px"},attrs:{type:"primary",size:"mini",icon:"el-icon-view"},on:{click:function(i){return e.handleEdit(t)}}},[e._v("编辑 ")]),i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:view"],expression:"['iot:device:view']"}],staticStyle:{padding:"5px 15px"},attrs:{type:"success",size:"mini",icon:"el-icon-odometer"},on:{click:function(i){return e.handDeviceView(t)}}},[e._v("运行状态 ")])],1)],1)],1)})),1),0==e.total?i("el-empty",{attrs:{description:"暂无数据，请添加设备"}}):e._e(),i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize,pageSizes:[12,24,36,60]},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1),i("el-dialog",{attrs:{title:e.title,visible:e.open,width:"60%"},on:{"update:visible":function(t){e.open=t},close:function(t){e.open=!1}}},[e.open?i("device-form",{attrs:{deviceId:e.deviceId},on:{success:e.handleSuccess,close:function(t){e.open=!1}}}):e._e()],1)],1)},r=[],s=i("c14f"),n=i("1da1"),l=(i("a9e3"),i("b64b"),i("d3b7"),i("25f0"),i("e350")),u=i("584f"),o=i("10f3"),c=i("f5a7"),d=i("b9d0"),p=i("3e47"),m={name:"Device",dicts:["iot_device_status","iot_is_enable","iot_location_way","iot_device_type"],components:{DeviceForm:p["default"]},data:function(){return{loading:!0,total:0,deviceList:[],myGroupList:[],baseUrl:"/prod-api",open:!1,title:"",queryParams:{pageNum:1,pageSize:12,deviceName:null,productId:null,landId:null,groupId:null,productName:null,serialNumber:null,status:null,deviceType:null},deviceId:0,landList:[]}},created:function(){this.getLandList();var e=this.$route.query.productId;null!=e&&(this.queryParams.productId=Number(e),this.queryParams.groupId=null,this.queryParams.serialNumber=null);var t=this.$route.query.groupId;null!=t&&(this.queryParams.groupId=Number(t),this.queryParams.productId=null,this.queryParams.serialNumber=null);var i=this.$route.query.sn;null!=i&&(this.queryParams.serialNumber=i,this.queryParams.productId=null,this.queryParams.groupId=null),this.connectMqtt()},activated:function(){var e=this.$route.query.t;if(null!=e&&e!=this.uniqueId){this.uniqueId=e;var t=this.$route.query.pageNum;null!=t&&(this.queryParams.pageNum=Number(t));var i=this.$route.query.productId;null!=i&&(this.queryParams.productId=Number(i),this.queryParams.groupId=null,this.queryParams.serialNumber=null);var a=this.$route.query.groupId;null!=a&&(this.queryParams.groupId=Number(a),this.queryParams.productId=null,this.queryParams.serialNumber=null);var r=this.$route.query.sn;null!=r&&(this.queryParams.serialNumber=r,this.queryParams.productId=null,this.queryParams.groupId=null),this.getList()}},methods:{checkPermi:l["a"],connectMqtt:function(){var e=this;return Object(n["a"])(Object(s["a"])().m((function t(){return Object(s["a"])().w((function(t){while(1)switch(t.n){case 0:if(null!=e.$mqttTool.client){t.n=1;break}return t.n=1,e.$mqttTool.connect();case 1:e.mqttCallback(),e.getList();case 2:return t.a(2)}}),t)})))()},mqttCallback:function(){var e=this;this.$mqttTool.client.on("message",(function(t,i,a){var r=t.split("/"),s=(r[1],r[2]);if(i=JSON.parse(i.toString()),i&&"status"==r[3]){console.log("接收到【设备状态】主题：",t),console.log("接收到【设备状态】内容：",i);for(var n=0;n<e.deviceList.length;n++)if(e.deviceList[n].serialNumber==s)return e.deviceList[n].status=i.status,e.deviceList[n].isShadow=i.isShadow,void(e.deviceList[n].rssi=i.rssi)}}))},mqttSubscribe:function(e){for(var t=[],i=0;i<e.length;i++){var a="/"+e[i].productId+"/"+e[i].serialNumber+"/status/post";t.push(a)}this.$mqttTool.subscribe(t)},getGroupList:function(){var e=this;this.loading=!0;var t={pageSize:30,pageNum:1,userId:this.$store.state.user.userId};Object(o["e"])(t).then((function(t){e.myGroupList=t.rows}))},getList:function(){var e=this;this.loading=!0,this.queryParams.params={},this.getGroupList(),Object(u["l"])(this.queryParams).then((function(t){e.deviceList=t.rows,e.total=t.total,e.deviceList&&e.deviceList.length>0&&e.mqttSubscribe(e.deviceList),e.loading=!1}))},getLandList:function(){var e=this;Object(d["d"])().then((function(t){e.landList=t.rows}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.queryParams.productId=null,this.queryParams.deviceType=null,this.queryParams.serialNumber=null,this.queryParams.landId=null,this.resetForm("queryForm"),this.handleQuery()},handleAddDevice:function(){this.deviceId=0,this.title="新增设备",this.open=!0},handleEdit:function(e){this.title="编辑设备",this.open=!0,this.deviceId=e.deviceId},handleEditDevice:function(e,t){var i=0;0!=e&&(i=e.deviceId||this.ids),this.$router.push({path:"/iot/device-edit",query:{deviceId:i,pageNum:this.queryParams.pageNum,activeName:t}})},handDeviceView:function(e){var t=e.productId;switch(t){case 98:this.$router.push({path:"/iot/camera/singlevideo",query:{t:Date.now(),deviceId:e.deviceId}});break;default:this.$router.push({path:"/iot/device-view",query:{t:Date.now(),deviceId:e.deviceId,productId:e.productId}});break}},handleDelete:function(e){var t=this,i=e.deviceId||this.ids;this.$modal.confirm('是否确认删除设备编号为"'+i+'"的数据项？').then((function(){return 3===e.deviceType&&Object(c["a"])(e.serialNumber),Object(u["b"])(i)})).then((function(){t.getList(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))},shadowUnEnable:function(e,t){return 3!=e.status&&0==e.isShadow||!!t.isReadonly},handleSuccess:function(){this.open=!1,this.getList()}}},v=m,h=(i("d095"),i("2877")),y=Object(h["a"])(v,a,r,!1,null,"3345c5f0",null);t["default"]=y.exports},d095:function(e,t,i){"use strict";i("95cf")},f5a7:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return n}));var a=i("b775");function r(e){return Object(a["a"])({url:"/sip/device/sipid/"+e,method:"delete"})}function s(e,t,i){return Object(a["a"])({url:"/sip/ptz/direction/"+e+"/"+t,method:"post",data:i})}function n(e,t,i){return Object(a["a"])({url:"/sip/ptz/scale/"+e+"/"+t,method:"post",data:i})}}}]);