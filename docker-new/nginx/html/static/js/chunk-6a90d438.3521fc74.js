(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6a90d438","chunk-5d792ca1","chunk-1022b97a","chunk-2f2532c4","chunk-2d0a3715","chunk-2d0c0c57"],{"01ca":function(e,t,i){"use strict";i.d(t,"f",(function(){return n})),i.d(t,"d",(function(){return r})),i.d(t,"a",(function(){return s})),i.d(t,"e",(function(){return o})),i.d(t,"g",(function(){return l})),i.d(t,"c",(function(){return c})),i.d(t,"b",(function(){return d}));var a=i("b775");function n(e){return Object(a["a"])({url:"/iot/model/list",method:"get",params:e})}function r(e){return Object(a["a"])({url:"/iot/model/"+e,method:"get"})}function s(e){return Object(a["a"])({url:"/iot/model",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/iot/model/import",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/iot/model",method:"put",data:e})}function c(e){return Object(a["a"])({url:"/iot/model/"+e,method:"delete"})}function d(e){return Object(a["a"])({url:"/iot/model/cache/"+e,method:"get"})}},2544:function(e,t,i){"use strict";i.d(t,"e",(function(){return n})),i.d(t,"d",(function(){return r})),i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"f",(function(){return l})),i.d(t,"c",(function(){return c}));var a=i("b775");function n(e){return Object(a["a"])({url:"/iot/deviceUser/list",method:"get",params:e})}function r(e,t){return Object(a["a"])({url:"/iot/deviceUser/"+e+"/"+t,method:"get"})}function s(e){return Object(a["a"])({url:"/iot/deviceUser",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/iot/deviceUser/addDeviceUsers",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/iot/deviceUser",method:"put",data:e})}function c(e){return Object(a["a"])({url:"/iot/deviceUser",method:"delete",data:e})}},"42cf":function(e,t,i){"use strict";i.r(t),i.d(t,"formatThingsModel",(function(){return a}));i("a434"),i("b0c0");function a(e){console.log("deviceinfo",e);e.monitorList=[];for(var t=0;t<e.thingsModels.length;t++)if("array"==e.thingsModels[t].dataType.type)if("object"==e.thingsModels[t].dataType.arrayType)for(var i=0;i<e.thingsModels[t].dataType.arrayParams.length;i++)for(var a=0;a<e.thingsModels[t].dataType.arrayParams[i].length;a++){var n=i>9?String(i):"0"+i,r="array_"+n+"_";e.thingsModels[t].dataType.arrayParams[i][a].id=r+e.thingsModels[t].dataType.arrayParams[i][a].id,1==e.thingsModels[t].dataType.arrayParams[i][a].isMonitor&&(e.thingsModels[t].dataType.arrayParams[i][a].name="["+e.thingsModels[t].name+(i+1)+"] "+e.thingsModels[t].dataType.arrayParams[i][a].name,e.thingsModels[t].dataType.arrayParams[i][a].dataType.arrayType="object",e.monitorList.push(e.thingsModels[t].dataType.arrayParams[i][a]),e.thingsModels[t].dataType.arrayParams[i].splice(a--,1))}else for(var s=""!=e.thingsModels[t].value?e.thingsModels[t].value.split(","):[],o=""!=e.thingsModels[t].shadow?e.thingsModels[t].shadow.split(","):[],l=0;l<e.thingsModels[t].dataType.arrayCount;l++){e.thingsModels[t].dataType.arrayModel||(e.thingsModels[t].dataType.arrayModel=[]);var c=l>9?String(l):"0"+l,d="array_"+c+"_";e.thingsModels[t].dataType.arrayModel[l]={id:d+e.thingsModels[t].id,name:e.thingsModels[t].name,type:e.thingsModels[t].type,isReadonly:e.thingsModels[t].isReadonly,value:s[l]?s[l]:"",shadow:o[l]?o[l]:""}}else if("object"==e.thingsModels[t].dataType.type)for(var u=0;u<e.thingsModels[t].dataType.params.length;u++)1==e.thingsModels[t].dataType.params[u].isMonitor&&(e.thingsModels[t].dataType.params[u].name="["+e.thingsModels[t].name+"] "+e.thingsModels[t].dataType.params[u].name,e.monitorList.push(e.thingsModels[t].dataType.params[u]),e.thingsModels[t].dataType.params.splice(u--,1));else 1==e.thingsModels[t].isMonitor&&(e.monitorList.push(e.thingsModels[t]),e.thingsModels.splice(t--,1))}},"4c26":function(e,t,i){},"6f3e":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));i("a4d3"),i("e01a"),i("d28b"),i("d3b7"),i("3ca3"),i("ddb0");var a=i("53ca");function n(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],i=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}}}throw new TypeError(Object(a["a"])(e)+" is not iterable")}},7168:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[i("el-form-item",{attrs:{label:"日志类型",prop:"logType"}},[i("el-select",{attrs:{placeholder:"请选择类型",clearable:"",size:"small"},model:{value:e.queryParams.logType,callback:function(t){e.$set(e.queryParams,"logType",t)},expression:"queryParams.logType"}},e._l(e.dict.type.iot_device_log_type,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",{attrs:{label:"标识符",prop:"identity"}},[i("el-input",{attrs:{placeholder:"请输入标识符",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.identity,callback:function(t){e.$set(e.queryParams,"identity",t)},expression:"queryParams.identity"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.deviceLogList,size:"mini"}},[i("el-table-column",{attrs:{label:"类型",align:"center",prop:"logType",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_device_log_type,value:t.row.logType}})]}}])}),i("el-table-column",{attrs:{label:"模式",align:"center",prop:"logType",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.mode?i("el-tag",{attrs:{type:"primary"}},[e._v("影子模式")]):2==t.row.mode?i("el-tag",{attrs:{type:"success"}},[e._v("在线模式")]):i("el-tag",{attrs:{type:"info"}},[e._v("其他信息")])]}}])}),i("el-table-column",{attrs:{label:"时间",align:"center",prop:"createTime",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.createTime))])]}}])}),i("el-table-column",{attrs:{label:"标识符",align:"center",prop:"identity"}}),i("el-table-column",{attrs:{label:"动作",align:"left","header-align":"center",prop:"logValue"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{domProps:{innerHTML:e._s(e.formatValueDisplay(t.row))}})]}}])}),i("el-table-column",{attrs:{label:"备注","header-align":"center",align:"left",prop:"remark"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(null==t.row.remark?"无":t.row.remark)+" ")]}}])})],1),i("div",{staticStyle:{height:"40px"}},[i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1)],1)},n=[],r=i("5530"),s=(i("b0c0"),i("a9e3"),i("a035")),o={name:"DeviceLog",dicts:["iot_device_log_type","iot_yes_no"],props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e,this.deviceInfo&&0!=this.deviceInfo.deviceId&&(this.queryParams.serialNumber=this.deviceInfo.serialNumber,this.getList(),this.thingsModel=this.deviceInfo.cacheThingsModel)}},data:function(){return{thingsModel:{},loading:!0,showSearch:!0,total:0,deviceLogList:[],queryParams:{pageNum:1,pageSize:10,logType:null,logValue:null,deviceId:null,serialNumber:null,deviceName:null,identity:null,isMonitor:null}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(s["a"])(this.queryParams).then((function(t){e.deviceLogList=t.rows,e.total=t.total,e.loading=!1}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleExport:function(){this.download("iot/deviceLog/export",Object(r["a"])({},this.queryParams),"deviceLog_".concat((new Date).getTime(),".xlsx"))},formatValueDisplay:function(e){if(1==e.logType){var t=this.getThingsModelItem(1,e.identity);if(""!=t)return(t.parentName?"["+t.parentName+(t.arrayIndex?t.arrayIndex:"")+"] ":"")+t.name+'： <span style="color:#409EFF;">'+this.getThingsModelItemValue(t,e.logValue)+" "+(void 0!=t.datatype.unit?t.datatype.unit:"")+"</span>"}else if(2==e.logType){var i=this.getThingsModelItem(2,e.identity);if(""!=i)return(i.parentName?"["+i.parentName+(i.arrayIndex?i.arrayIndex:"")+"] ":"")+i.name+'： <span style="color:#409EFF">'+this.getThingsModelItemValue(i,e.logValue)+" "+(void 0!=i.datatype.unit?i.datatype.unit:"")+"</span>"}else if(3==e.logType){var a=this.getThingsModelItem(3,e.identity);if(""!=a)return(a.parentName?"["+a.parentName+(a.arrayIndex?a.arrayIndex:"")+"] ":"")+a.name+'： <span style="color:#409EFF">'+this.getThingsModelItemValue(a,e.logValue)+" "+(void 0!=a.datatype.unit?a.datatype.unit:"")+"</span>"}else{if(4==e.logType)return'<span style="font-weight:bold">设备升级</span>';if(5==e.logType)return'<span style="font-weight:bold">设备上线</span>';if(6==e.logType)return'<span style="font-weight:bold">设备离线</span>'}return""},getThingsModelItemValue:function(e,t){if("bool"==e.datatype.type){if("0"==t)return e.datatype.falseText;if("1"==t)return e.datatype.trueText}else if("enum"==e.datatype.type)for(var i=0;i<e.datatype.enumList.length;i++)if(t==e.datatype.enumList[i].value)return e.datatype.enumList[i].text;return t},getThingsModelItem:function(e,t){if(1==e&&this.thingsModel.properties)for(var i=0;i<this.thingsModel.properties.length;i++){if(this.thingsModel.properties[i].id==t)return this.thingsModel.properties[i];if("object"==this.thingsModel.properties[i].datatype.type)for(var a=0;a<this.thingsModel.properties[i].datatype.params.length;a++)if(this.thingsModel.properties[i].datatype.params[a].id==t)return this.thingsModel.properties[i].datatype.params[a].parentName=this.thingsModel.properties[i].name,this.thingsModel.properties[i].datatype.params[a];if("array"==this.thingsModel.properties[i].datatype.type&&this.thingsModel.properties[i].datatype.arrayType)if("object"==this.thingsModel.properties[i].datatype.arrayType){var n=t,r=0;t.indexOf("array_")>-1&&(r=t.substring(6,8),n=t.substring(9));for(var s=0;s<this.thingsModel.properties[i].datatype.params.length;s++)if(this.thingsModel.properties[i].datatype.params[s].id==n)return this.thingsModel.properties[i].datatype.params[s].arrayIndex=Number(r)+1,this.thingsModel.properties[i].datatype.params[s].parentName=this.thingsModel.properties[i].name,this.thingsModel.properties[i].datatype.params[s]}else for(var o=0;o<this.thingsModel.properties[i].datatype.arrayCount.length;o++)if(this.thingsModel.properties[i].id==realIdentity)return this.thingsModel.properties[i].arrayIndex=Number(arrayIndex)+1,this.thingsModel.properties[i].parentName="元素",this.thingsModel.properties[i]}else if(2==e&&this.thingsModel.functions)for(var l=0;l<this.thingsModel.functions.length;l++){if(this.thingsModel.functions[l].id==t)return this.thingsModel.functions[l];if("object"==this.thingsModel.functions[l].datatype.type)for(var c=0;c<this.thingsModel.functions[l].datatype.params.length;c++)if(this.thingsModel.functions[l].datatype.params[c].id==t)return this.thingsModel.functions[l].datatype.params[c].parentName=this.thingsModel.functions[l].name,this.thingsModel.functions[l].datatype.params[c];if("array"==this.thingsModel.functions[l].datatype.type&&this.thingsModel.functions[l].datatype.arrayType){var d=t,u=0;if(t.indexOf("array_")>-1&&(u=t.substring(6,8),d=t.substring(9)),"object"==this.thingsModel.functions[l].datatype.arrayType){for(var h=0;h<this.thingsModel.functions[l].datatype.params.length;h++)if(this.thingsModel.functions[l].datatype.params[h].id==d)return this.thingsModel.functions[l].datatype.params[h].arrayIndex=Number(u)+1,this.thingsModel.functions[l].datatype.params[h].parentName=this.thingsModel.functions[l].name,this.thingsModel.functions[l].datatype.params[h]}else for(var p=0;p<this.thingsModel.functions[l].datatype.arrayCount.length;p++)if(this.thingsModel.functions[l].id==d)return this.thingsModel.functions[l].arrayIndex=Number(u)+1,this.thingsModel.functions[l].parentName="元素",this.thingsModel.functions[l]}}else if(3==e&&this.thingsModel.events)for(var m=0;m<this.thingsModel.events.length;m++)if(this.thingsModel.events[m].id==t)return this.thingsModel.events[m];return""}}},l=o,c=i("2877"),d=Object(c["a"])(l,a,n,!1,null,null,null);t["default"]=d.exports},"78f0":function(e,t,i){"use strict";i("4c26")},a035:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));var a=i("b775");function n(e){return Object(a["a"])({url:"/iot/deviceLog/list",method:"get",params:e})}function r(e){return Object(a["a"])({url:"/iot/deviceLog/monitor",method:"get",params:e})}},a268:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"header"},[i("div",{staticClass:"left"},[i("img",{staticClass:"img",attrs:{src:e.$baseUrl+e.device.imgUrl.split(",")[0],alt:""}})]),i("div",{staticClass:"right"},[i("div",{staticClass:"name"},[e._v(e._s(e.device&&e.device.deviceName))]),i("div",{staticClass:"des"},[i("span",[e._v("编号:")]),e._v(" "+e._s(e.device&&e.device.serialNumber)+" "),i("el-tag",{staticClass:"margin-left-10",attrs:{type:e.deviceStatus.color,size:"mini"}},[e._v(e._s(e.deviceStatus.title))])],1)])]),i("div",{staticClass:"body"},[i("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"采集数据",name:"p1"}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"content",class:{grey:e.grey,padding0:e.noPadding}},[e._t("p1",null,{device:e.device})],2)])]),i("el-tab-pane",{attrs:{label:"定时任务",name:"p2"}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"content"},[e._t("p2",[i("device-timer",{staticClass:"margin-top-20",attrs:{device:e.device}})])],2)])]),i("el-tab-pane",{attrs:{label:"设备用户",name:"p3"}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"content"},[e._t("p3",[i("device-user",{staticClass:"margin-top-20",attrs:{device:e.device}})])],2)])]),i("el-tab-pane",{attrs:{label:"设备日志",name:"p4"}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"content"},[e._t("p4",[i("device-log",{staticClass:"margin-top-20",attrs:{device:e.device}})])],2)])]),i("el-tab-pane",{attrs:{label:"数据分析",name:"p5"}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"content"},[e._t("p5",[i("device-statistic",{staticClass:"margin-top-20",attrs:{"chart-visible":e.chartVisible,device:e.device}})])],2)])]),e._t("tabs")],2)],1)])},n=[],r=i("c14f"),s=i("1da1"),o=(i("a9e3"),i("b64b"),i("d3b7"),i("3e47")),l=i("7a72"),c=i("b52e"),d=i("7168"),u=i("f14e"),h=i("584f"),p=i("01ca"),m=i("42cf"),f={name:"DeviceView",components:{DeviceForm:o["default"],DeviceTimer:l["default"],DeviceUser:c["default"],DeviceLog:d["default"],DeviceStatistic:u["default"]},props:{deviceId:[Number,String],grey:{type:Boolean,default:!1},noPadding:!1},data:function(){return{device:{imgUrl:""},activeName:"p1",chartVisible:!1}},computed:{deviceStatus:function(){var e=this.device;return 3==e.status?{title:"在线模式",color:"primary"}:1==e.isShadow?{title:"影子模式",color:"warning"}:{title:"离线模式",color:"danger"}}},created:function(){this.deviceId&&this.getDevice()},methods:{handleTabClick:function(e){"p5"==e.paneName&&(this.chartVisible=!0)},getDevice:function(){var e=this;return Object(s["a"])(Object(r["a"])().m((function t(){var i;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:i=e.deviceId,Object(h["e"])(i).then(function(){var t=Object(s["a"])(Object(r["a"])().m((function t(a){return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:return t.n=1,e.getCacheThingsModdel(a.data.productId);case 1:return a.data.cacheThingsModel=t.v,t.n=2,e.getDeviceStatus(i);case 2:a.data.thingsModels=t.v,Object(m["formatThingsModel"])(a.data),e.device=a.data,null!=e.device.summary&&""!=e.device.summary&&(e.summary=JSON.parse(e.device.summary));case 3:return t.a(2)}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:return t.a(2)}}),t)})))()},getCacheThingsModdel:function(e){return new Promise((function(t,i){Object(p["b"])(e).then((function(e){t(JSON.parse(e.data))})).catch((function(e){i(e)}))}))},getDeviceStatus:function(e){return new Promise((function(t,i){Object(h["g"])(e).then((function(e){t(e.data.thingsModels)})).catch((function(e){i(e)}))}))}}},g=f,y=(i("78f0"),i("2877")),v=Object(y["a"])(g,a,n,!1,null,"072a94a4",null);t["default"]=v.exports},b52e:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",{staticClass:"mb8",attrs:{gutter:10}},[i("el-col",{attrs:{span:1.5}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:deviceshare:add"],expression:"['iot:deviceshare:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-share",size:"mini"},on:{click:e.selectUser}},[e._v("分享设备")])],1),i("el-col",{attrs:{span:1.5}},[i("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-refresh",size:"mini"},on:{click:e.getList}},[e._v("刷新")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.deviceUserList,size:"mini"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{label:"用户编号",align:"center",prop:"userId",width:"100"}}),i("el-table-column",{attrs:{label:"用户名称",align:"center",prop:"userName"}}),i("el-table-column",{attrs:{label:"手机号码",align:"center",prop:"phonenumber",width:"150"}}),i("el-table-column",{attrs:{label:"用户类型",align:"center",prop:"isOwner",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isOwner?i("el-tag",{attrs:{type:"primary"}},[e._v("主人")]):i("el-tag",{attrs:{type:"success"}},[e._v("分享")])]}}])}),i("el-table-column",{attrs:{label:"分享时间",align:"center",prop:"createTime",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime,"{y}-{m}-{d}")))])]}}])}),i("el-table-column",{attrs:{label:"备注",align:"left",prop:"remark","header-align":"center","min-width":"150"}}),i("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.isOwner&&e.checkPermi(["iot:deviceshare:edit"])&&e.checkPermi(["iot:deviceshare:remark"])&&e.checkPermi(["iot:deviceshare:query"])?i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(i){return e.handleUpdate(t.row)}}},[e._v("备注")]):e._e(),0==t.row.isOwner?i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:deviceshare:remove"],expression:"['iot:deviceshare:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("取消分享")]):e._e()]}}])})],1),i("el-dialog",{attrs:{title:e.title,visible:e.open,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",rows:"4"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}}),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),i("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),i("user-list",{ref:"userList",attrs:{device:e.devices}})],1)},n=[],r=i("5530"),s=(i("d81d"),i("b64b"),i("d3b7"),i("0643"),i("a573"),i("e350")),o=i("e018"),l=i("2544"),c={name:"device-user",dicts:["iot_yes_no"],components:{userList:o["default"]},props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e,this.devices=[e],this.deviceInfo&&0!=this.deviceInfo.deviceId&&(this.queryParams.deviceId=this.deviceInfo.deviceId,this.getList())}},data:function(){return{devices:[],loading:!0,ids:[],single:!0,multiple:!0,total:0,deviceUserList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,deviceName:null,userName:null,userId:null,tenantName:null,isOwner:null},form:{},rules:{deviceName:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],userName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}]}}},created:function(){Object.keys(this.device).length>0&&(this.queryParams.deviceId=this.device.deviceId,this.getList())},methods:{checkPermi:s["a"],getList:function(){var e=this;this.loading=!0,Object(l["e"])(this.queryParams).then((function(t){e.deviceUserList=t.rows,e.total=t.total,e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={deviceId:null,userId:null,deviceName:null,userName:null,tenantId:null,tenantName:null,isOwner:null,limitNum:null,delFlag:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.deviceId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="添加设备用户"},handleUpdate:function(e){var t=this;this.reset();var i=e.deviceId||this.ids;Object(l["d"])(i,e.userId).then((function(e){t.form=e.data,t.open=!0,t.title="用户备注"}))},submitForm:function(){var e=this;null!=this.form.deviceId&&Object(l["f"])(this.form).then((function(t){e.$modal.msgSuccess("备注成功"),e.open=!1,e.getList()}))},handleDelete:function(e){var t=this,i=e;this.$modal.confirm("确认取消分享设备？").then((function(){return Object(l["c"])(i)})).then((function(){t.getList(),t.$modal.msgSuccess("取消分享成功")})).catch((function(){}))},handleExport:function(){this.download("iot/deviceUser/export",Object(r["a"])({},this.queryParams),"deviceUser_".concat((new Date).getTime(),".xlsx"))},selectUser:function(){this.devices=[this.device],this.$refs.userList.openSelectUser=!0}}},d=c,u=i("2877"),h=Object(u["a"])(d,a,n,!1,null,null,null);t["default"]=h.exports},bb86:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r}));var a=i("b775");i("bc3a"),i("5c96"),i("21a6"),i("5f87"),i("c38a");function n(e){return Object(a["a"])({url:"/iot/tool/register",headers:{isToken:!1},method:"post",data:e})}function r(e){return Object(a["a"])({url:"/iot/tool/userList",method:"get",params:e})}},e018:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"选择用户",visible:e.openSelectUser,width:"800px"},on:{"update:visible":function(t){e.openSelectUser=t}}},[i("div",{staticStyle:{"margin-top":"-50px"}},[i("el-divider")],1),i("el-form",{ref:"queryForm",attrs:{model:e.queryParams,rules:e.rules,inline:!0,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"手机号码",prop:"phonenumber"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{type:"text",placeholder:"请输入用户手机号码",minlength:"10",clearable:"",size:"small","show-word-limit":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.phonenumber,callback:function(t){e.$set(e.queryParams,"phonenumber",t)},expression:"queryParams.phonenumber"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("查询")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.userList,"highlight-current-row":"",size:"mini",border:""},on:{"current-change":e.handleCurrentChange}},[i("el-table-column",{attrs:{label:"选择",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("input",{attrs:{type:"radio",name:"user"},domProps:{checked:e.row.isSelect}})]}}])}),i("el-table-column",{key:"userId",attrs:{label:"用户编号",align:"center",prop:"userId",width:"120"}}),i("el-table-column",{key:"userName",attrs:{label:"用户名称",align:"center",prop:"userName"}}),i("el-table-column",{key:"nickName",attrs:{label:"用户昵称",align:"center",prop:"nickName"}}),i("el-table-column",{key:"phonenumber",attrs:{label:"手机号码",align:"center",prop:"phonenumber",width:"120"}}),i("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.addDeviceUser}},[e._v("分享")]),i("el-button",{on:{click:e.closeSelectUser}},[e._v("关 闭")])],1)],1)},n=[],r=(i("d3b7"),i("0643"),i("4e3e"),i("159b"),i("bb86")),s=i("2544"),o={name:"user-list",props:{device:{type:Array,default:null}},watch:{device:function(e,t){this.deviceInfo=e}},data:function(){return{loading:!1,ids:[],title:"",userList:[],user:{},deviceInfo:{},openSelectUser:!1,queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:0,deptId:void 0},rules:{phonenumber:[{required:!0,message:"手机号码不能为空",trigger:"blur"},{min:11,max:11,message:"手机号码长度为11位",trigger:"blur"}]}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(r["a"])(this.addDateRange(this.queryParams,this.dateRange)).then((function(t){e.userList=t.rows,e.total=t.total,e.loading=!1}))},handleQuery:function(){var e=this;this.$refs["queryForm"].validate((function(t){t&&(e.queryParams.pageNum=1,e.getList())}))},resetQuery:function(){this.$refs["queryForm"].resetFields(),this.userList=[]},setRadioSelected:function(e){for(var t=0;t<this.userList.length;t++)this.userList[t].userId==e?(this.userList[t].isSelect=!0,this.user=this.userList[t]):this.userList[t].isSelect=!1},handleCurrentChange:function(e){null!=e&&(this.setRadioSelected(e.userId),this.user=e)},closeSelectUser:function(){this.openSelectUser=!1,this.resetQuery()},addDeviceUser:function(){var e=this;if(null!=this.deviceInfo&&this.deviceInfo.length>0&&null!=this.user)if(1==this.deviceInfo.length){var t={};t.deviceId=this.deviceInfo[0].deviceId,t.deviceName=this.deviceInfo[0].deviceName,t.userId=this.user.userId,t.userName=this.user.userName,t.phonenumber=this.user.phonenumber,Object(s["a"])(t).then((function(t){e.$modal.msgSuccess("新增成功"),e.resetQuery(),e.openSelectUser=!1,e.$parent.getList()}))}else{t=[];this.deviceInfo.forEach((function(i){var a={};a.deviceId=i.deviceId,a.deviceName=i.deviceName,a.userId=e.user.userId,a.userName=e.user.userName,a.phonenumber=e.user.phonenumber,t.push(a)})),Object(s["b"])(t).then((function(t){e.$modal.msgSuccess("新增成功"),e.resetQuery(),e.openSelectUser=!1,e.$parent.getList()}))}else this.openSelectUser=!1}}},l=o,c=i("2877"),d=Object(c["a"])(l,a,n,!1,null,null,null);t["default"]=d.exports},f14e:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",[i("el-col",{attrs:{span:24}},[i("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"75px"}},[i("el-form-item",{attrs:{label:"时间范围"}},[i("el-date-picker",{staticStyle:{width:"240px"},attrs:{size:"small","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.daterangeTime,callback:function(t){e.daterangeTime=t},expression:"daterangeTime"}})],1),i("el-form-item",{attrs:{label:"最大数量"}},[i("el-input",{model:{value:e.queryParams.total,callback:function(t){e.$set(e.queryParams,"total",t)},expression:"queryParams.total"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.getStatisticData}},[e._v("查询")])],1)],1)],1),i("el-col",{attrs:{span:24}},e._l(e.monitorThings,(function(e,t){return i("div",{key:t,staticStyle:{"margin-bottom":"30px",width:"100%"}},[i("div",{ref:"statisticMap",refInFor:!0,staticStyle:{height:"300px",width:"100%"}})])})),0)],1)],1)},n=[],r=i("6f3e"),s=i("c14f"),o=i("1da1"),l=(i("b0c0"),i("3ca3"),i("ddb0"),i("a035")),c={name:"device-statistic",props:{device:{type:Object,default:null},chartVisible:{type:Boolean,default:!1}},watch:{device:function(e,t){this.deviceInfo=e,this.deviceInfo&&0!=this.deviceInfo.deviceId&&(this.monitorThings=this.deviceInfo.monitorList,this.$nextTick((function(){this.getStatistic(),this.getStatisticData(this.monitorThings)})))},chartVisible:{handler:function(e,t){if(e)for(var i=0;i<this.monitorThings.length;i++)this.chart[i].resize()}}},data:function(){return{deviceInfo:{},monitorThings:[],chart:[],daterangeTime:[],queryParams:{serialNumber:null,identity:"",total:50},arrayData:[]}},methods:{getStatisticData:function(){var e=this;return Object(o["a"])(Object(s["a"])().m((function t(){var i,a;return Object(s["a"])().w((function(t){while(1)switch(t.n){case 0:i=Object(s["a"])().m((function t(i){return Object(s["a"])().w((function(t){while(1)switch(t.n){case 0:e.queryParams.serialNumber=e.deviceInfo.serialNumber,e.queryParams.identity=e.monitorThings[i].id,null!=e.daterangeTime&&""!=e.daterangeTime&&(e.queryParams.beginTime=e.daterangeTime[0],e.queryParams.endTime=e.daterangeTime[1]+" 23:59"),String(e.monitorThings[i].id)&&Object(l["b"])(e.queryParams).then((function(t){for(var a=t.rows,n=[],r=0;r<a.length;r++){var s=[];s[0]=a[r].time,s[1]=a[r].value,n.push(s)}e.chart[i].setOption({series:[{data:n}]})}));case 1:return t.a(2)}}),t)})),a=0;case 1:if(!(a<e.monitorThings.length)){t.n=3;break}return t.d(Object(r["a"])(i(a)),2);case 2:a++,t.n=1;break;case 3:return t.a(2)}}),t)})))()},getStatistic:function(){for(var e=["#1890FF","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],t=0;t<this.monitorThings.length;t++){var i;this.chart[t]=this.$echarts.init(this.$refs.statisticMap[t]),i={animationDurationUpdate:3e3,tooltip:{trigger:"axis"},title:{left:"center",text:this.monitorThings[t].name+"统计 （单位 "+(void 0!=this.monitorThings[t].dataType.unit?this.monitorThings[t].dataType.unit:"无")+"）"},grid:{top:"80px",left:"40px",right:"20px",bottom:"60px",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},xAxis:{type:"time"},yAxis:{type:"value"},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],series:[{name:this.monitorThings[t].name,type:"line",symbol:"none",sampling:"lttb",itemStyle:{color:t>9?e[0]:e[t]},areaStyle:{},data:[]}]},i&&this.chart[t].setOption(i)}}}},d=c,u=i("2877"),h=Object(u["a"])(d,a,n,!1,null,null,null);t["default"]=h.exports}}]);